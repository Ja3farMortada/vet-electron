import{a as lt}from"./chunk-ERLERYPQ.js";import{b as ut}from"./chunk-VNSJTRCW.js";import{a as nt,b as Mt,c as Ft}from"./chunk-ZDC3MCEG.js";import{a as at,c as Bt}from"./chunk-F55XOBOM.js";import{a as Pe}from"./chunk-3MNELIWF.js";import"./chunk-QNGQUUWN.js";import{a as ot,b as kt,c as De}from"./chunk-MM2ILL2R.js";import{b as Nt,d as Ot}from"./chunk-TFLCFXZP.js";import{a as Ve}from"./chunk-35NGRNBH.js";import{a as rt}from"./chunk-RRWPY7RN.js";import{a as Te}from"./chunk-CXRP5GN6.js";import{a as se}from"./chunk-GOWH2OVL.js";import{a as et}from"./chunk-IQBTQCL7.js";import{a as J,b as it}from"./chunk-S7PF4F6G.js";import{a as ce}from"./chunk-RU3D3T7J.js";import{c as K}from"./chunk-DGZ4MYEP.js";import"./chunk-HKBVJRXU.js";import{a as Vt,b as tt}from"./chunk-UPEO3OJJ.js";import{b as Ye,c as Et,f as H,g as It,h as Tt,j as Dt,k as Je,l as Xe,q as Ze}from"./chunk-5RWI34IA.js";import{b as Ht}from"./chunk-X2LN5D3L.js";import"./chunk-LSU6PTXH.js";import{a as Pt,b as pe}from"./chunk-5HBZH4F2.js";import"./chunk-LQIUUWFA.js";import{a as N,b as je}from"./chunk-VZUVB6OR.js";import{i as z,j as Qe,m as R,n as Ke}from"./chunk-IQYDCUJX.js";import{$a as ae,Aa as o,Ac as Ie,Ba as y,Bc as $e,C as Se,Cb as F,Cc as xt,Db as Le,Fa as x,Fb as le,Ga as d,Ha as c,J as re,K as Ne,Ka as ze,Lc as ie,Mc as O,N as h,Na as gt,Nc as Ge,O as V,Oa as ft,Oc as $,P as Oe,Pa as vt,Pc as Ue,Ra as l,Sa as g,Ta as S,U as Re,Ub as dt,V as u,Va as w,W as _,Wa as E,Xa as I,Za as yt,_ as be,_a as T,_b as qe,a as Me,ab as xe,b as Fe,bb as Ct,ed as ne,fd as wt,g as _t,ha as a,hb as C,hc as k,i as Z,ib as b,kb as oe,kc as j,l as Ce,lc as q,nc as A,oa as P,ra as v,rc as B,sc as G,ta as p,tb as St,tc as te,ub as bt,uc as D,va as ht,vc as Ee,wa as L,wb as we,wc as U,xb as We,xc as Q,yb as ee,yc as Y,za as i,zc as Ae}from"./chunk-ZWYFQ3XA.js";var X=(()=>{class n{constructor(){this.http=h(le),this.apiService=h(q),this.notificationService=h(j),this.salesHistory=P([]),this.deletedHistory=P([]),this.paymentsHistory=P([]),this.signal_loading=P(!1),this.moneyTransfersHistory=P([]),this.returnHistory=P([]),this.receiptsHistory=P([]),this.purchasesHistory=P([])}fetchSalesHistory(e){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/sales/search`,e).subscribe({next:r=>{this.salesHistory.set(r),this.signal_loading.set(!1)},error:r=>{this.signal_loading.set(!1),this.notificationService.handleError(r.error,"home")}})}fetchDeletedHistory(e){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/deleted/search`,e).subscribe({next:r=>{this.deletedHistory.set(r),this.signal_loading.set(!1)},error:r=>{this.signal_loading.set(!1),this.notificationService.handleError(r.error,"home")}})}fetchPaymentHistory(e){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/payment/search`,e).subscribe({next:r=>{this.paymentsHistory.set(r),this.signal_loading.set(!1)},error:r=>{this.signal_loading.set(!1),this.notificationService.handleError(r.error,"home")}})}fetchMoneyTransferHistory(e){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/money-transfer/search`,e).subscribe({next:r=>{this.moneyTransfersHistory.set(r),this.signal_loading.set(!1)},error:r=>{this.signal_loading.set(!1),this.notificationService.handleError(r.error,"home")}})}fetchReturnHistory(e){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/return/search`,e).subscribe({next:r=>{this.returnHistory.set(r),this.signal_loading.set(!1)},error:r=>{this.signal_loading.set(!1),this.notificationService.handleError(r.error,"home")}})}fetchPurchasesHistory(e){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/purchase/search`,e).subscribe({next:r=>{this.purchasesHistory.set(r),this.signal_loading.set(!1)},error:r=>{this.signal_loading.set(!1),this.notificationService.handleError(r.error,"home")}})}fetchReceiptsHistory(e){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/receipt/search`,e).subscribe({next:r=>{this.receiptsHistory.set(r),this.signal_loading.set(!1)},error:r=>{this.signal_loading.set(!1),this.notificationService.handleError(r.error,"home")}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=re({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var st=(()=>{class n{constructor(){this.http=h(le),this.api=h(q),this.notificationService=h(j),this.whatsappLoading=P(!1)}sendMessage(e){this.whatsappLoading.set(!0),this.http.post(`${this.api.host}/send-whatsapp`,e).subscribe({next:r=>{this.notificationService.showInfo(r.message,"home",!1),this.whatsappLoading.set(!1)},error:r=>{this.whatsappLoading.set(!1),this.notificationService.showError("Error sending whatsapp!","home")}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=re({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Rt=(()=>{class n{constructor(){this.apiService=h(q),this.http=h(le),this.notificationService=h(j),this.customersService=h(K),this.host=this.apiService.host,this.currentInvoice=P({}),this.signal_submited=P(!1),this.signal_submit_loading=P(!1),this.action_status$=new Ce(""),this.selectedCustomerLatestItems=new Ce([])}checkout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/sell-orders`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getCustomerTotalBalance(e.customer_id)}})}returnCheckout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getCustomerTotalBalance(e.customer_id)}})}deleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/sell-orders/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getCustomerTotalBalance(e.customer_id)}})}returnDeleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getCustomerTotalBalance(e.customer_id)}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=re({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var zt=_t(Pt());var ai=()=>({width:"95vw",height:"75vh"}),li=()=>({width:"65vw"}),si=()=>({"1199px":"75vw","575px":"95vw"}),pi=()=>({width:"35vw"}),ci=()=>({standalone:!0}),mi=n=>({invalid:n}),di=n=>({"text-orange-500":n}),ui=n=>({selected:n});function _i(n,m){n&1&&(i(0,"tr")(1,"th",31),l(2,"Barcode"),o(),i(3,"th",32),l(4,"Description"),o(),i(5,"th",33),l(6,"Unit"),o(),i(7,"th",33),l(8,"Discount"),o(),i(9,"th",34),l(10,"Qty"),o(),i(11,"th",33),l(12,"Total"),o(),i(13,"th",34),l(14,"Del?"),o()())}function hi(n,m){if(n&1){let e=x();i(0,"p-inputNumber",42),I("ngModelChange",function(t){u(e);let s=c().$implicit;return E(s.unit_price,t)||(s.unit_price=t),_(t)}),d("ngModelChange",function(){u(e);let t=c().$implicit,s=c(2);return _(s.setPrice(t))})("onFocus",function(t){u(e);let s=c(3);return _(s.select(t.target))}),o()}if(n&2){let e=c().$implicit;w("ngModel",e.unit_price),p("maxFractionDigits",2)("min",0)}}function gi(n,m){n&1&&y(0,"i",45)}function fi(n,m){if(n&1&&(i(0,"span",43),l(1),C(2,"currency"),i(3,"span"),v(4,gi,1,0,"i",44),o()()),n&2){let e=c().$implicit,r=c(2);p("ngClass",ae(5,di,r.getPriceWarining(e))),a(),g(b(2,3,e.unit_price)),a(3),p("ngIf",r.getPriceWarining(e))}}function vi(n,m){if(n&1){let e=x();i(0,"p-inputNumber",46,2),I("ngModelChange",function(t){u(e);let s=c().$implicit;return E(s.discount_percentage,t)||(s.discount_percentage=t),_(t)}),d("ngModelChange",function(){u(e);let t=c().rowIndex,s=c(2);return _(s.onDiscountChange(t))})("onFocus",function(t){u(e);let s=c(3);return _(s.select(t.target))}),o()}if(n&2){let e=c().$implicit;w("ngModel",e.discount_percentage),p("maxFractionDigits",2)("min",0)}}function yi(n,m){if(n&1&&(i(0,"span"),l(1),o()),n&2){let e=c().$implicit;a(),S("",e.discount_percentage,"%")}}function Ci(n,m){if(n&1){let e=x();i(0,"p-inputNumber",47),I("ngModelChange",function(t){u(e);let s=c().$implicit;return E(s.quantity,t)||(s.quantity=t),_(t)}),d("onFocus",function(t){u(e);let s=c(3);return _(s.select(t.target))})("ngModelChange",function(){u(e);let t=c().$implicit,s=c(2);return _(s.setQty(t))}),o()}if(n&2){let e=c().$implicit;w("ngModel",e.quantity),p("maxFractionDigits",2)("minFractionDigits",0)}}function Si(n,m){if(n&1&&(i(0,"span"),l(1),o()),n&2){let e=c().$implicit;a(),g(e.quantity)}}function bi(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),y(5,"br"),i(6,"small"),l(7),o()(),i(8,"td",35)(9,"p-cellEditor"),v(10,hi,1,3,"ng-template",36)(11,fi,5,7,"ng-template",37),o()(),i(12,"td",38)(13,"p-cellEditor"),v(14,vi,2,3,"ng-template",36)(15,yi,2,1,"ng-template",37),o()(),i(16,"td",39)(17,"p-cellEditor"),v(18,Ci,1,3,"ng-template",36)(19,Si,2,1,"ng-template",37),o()(),i(20,"td"),l(21),C(22,"currency"),o(),i(23,"td",40),d("click",function(){let t=u(e).rowIndex,s=c(2);return _(s.removeRow(t))}),y(24,"i",41),o()()}if(n&2){let e=m.$implicit;a(2),g(e.barcode||"---"),a(2),S(" ",e.product_name," "),a(3),g(e.expiry_date),a(),p("pEditableColumn",e.unit_price),a(4),p("pEditableColumn",e.discount_percentage),a(4),p("pEditableColumn",e.quantity)("ngClass",ae(10,mi,!e.quantity)),a(5),S(" ",b(22,8,e.unit_price*e.quantity)," ")}}function xi(n,m){if(n&1&&(i(0,"h4",49),l(1),o()),n&2){let e=c(3);a(),S(" Total units: ",e.invoiceTotal.total_qty," ")}}function wi(n,m){if(n&1&&v(0,xi,2,1,"h4",48),n&2){let e=c(2);p("ngIf",e.invoiceTotal.total_qty)}}function Ei(n,m){n&1&&(i(0,"tr",50)(1,"td",51),l(2,"No data yet!"),o()())}function Ii(n,m){if(n&1){let e=x();i(0,"p-card",10)(1,"div",11)(2,"div",12)(3,"div",13),y(4,"div",14),i(5,"label"),l(6,"Invoice Date"),o(),i(7,"p-calendar",15),I("ngModelChange",function(t){u(e);let s=c();return E(s.invoice_date,t)||(s.invoice_date=t),_(t)}),o()()(),i(8,"div",12)(9,"div",14)(10,"label",16),l(11,"Customer"),o(),i(12,"p-dropdown",17),I("ngModelChange",function(t){u(e);let s=c();return E(s.customer_id,t)||(s.customer_id=t),_(t)}),d("onChange",function(t){u(e);let s=c();return _(s.customerChange(t.value))}),o()()(),i(13,"div",18)(14,"h3",19),l(15),C(16,"currency"),o(),i(17,"h3",20),l(18),C(19,"lira"),o()()(),i(20,"div",11)(21,"div",21)(22,"p-table",22,0),d("onEditComplete",function(t){u(e);let s=c();return _(s.onEditComplete(t))}),v(24,_i,15,0,"ng-template",23)(25,bi,25,12,"ng-template",4)(26,wi,1,1,"ng-template",24)(27,Ei,3,0,"ng-template",25),o()(),i(28,"div",26)(29,"p-autoComplete",27,1),I("ngModelChange",function(t){u(e);let s=c();return E(s.search_product,t)||(s.search_product=t),_(t)}),d("completeMethod",function(t){u(e);let s=c();return _(s.searchItem(t))})("onKeyUp",function(t){u(e);let s=c();return _(s.submitInvoiceInput(t))}),o(),i(31,"button",28),d("click",function(){u(e);let t=c();return _(t.openProductsDialog())}),o()(),y(32,"div",26),i(33,"div",26)(34,"label",29),l(35,"Reason:"),o(),i(36,"input",30),I("ngModelChange",function(t){u(e);let s=c();return E(s.update_reason,t)||(s.update_reason=t),_(t)}),o()()()()}if(n&2){let e=c();a(7),w("ngModel",e.invoice_date),p("ngModelOptions",T(26,ci))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),a(5),w("ngModel",e.customer_id),p("options",e.customers)("filter",!0)("showClear",!0),a(3),S(" USD: ",b(16,22,e.invoiceTotal.total_dollar)," "),a(3),S(" LBP: ",b(19,24,e.invoiceTotal.total_dollar*e.invoice.exchange_rate)," "),a(4),ze("scrollHeight",e.vh),p("value",e.order_items)("scrollable",!0),a(7),w("ngModel",e.search_product),p("suggestions",e.matching_products)("delay",150)("autofocus",!0),a(7),ht("invalid",!e.update_reason),w("ngModel",e.update_reason)}}function Ti(n,m){if(n&1){let e=x();i(0,"p-button",55),d("onClick",function(){u(e);let t=c(2);return _(t.deleteDialogVisible=!0)}),o()}if(n&2){let e=c(2);p("disabled",e.submitted())}}function Di(n,m){if(n&1){let e=x();v(0,Ti,1,1,"p-button",52),i(1,"p-button",53),d("onClick",function(){u(e);let t=c();return _(t.closeEditDialog())}),o(),i(2,"p-button",54),d("onClick",function(){u(e);let t=c();return _(t.submitEditInvoice())}),o()}if(n&2){let e=c();p("ngIf",e.userPermissions().delete_invoice),a(),p("disabled",e.submitted()),a(),p("loading",e.submitted())("disabled",e.order_items.length==0||!e.update_reason)}}function Pi(n,m){if(n&1){let e=x();i(0,"div",57)(1,"div",58),d("click",function(){let t=u(e).$implicit,s=c(2);return _(s.selectedVariant=t)}),i(2,"p"),l(3),y(4,"br"),i(5,"small"),l(6),o()()()()}if(n&2){let e=m.$implicit,r=c(2);a(),p("ngClass",ae(3,ui,r.selectedVariant==e)),a(2),S(" ",e.expiry_date," "),a(3),S("Current qty: ",e.variant_quantity,"")}}function Vi(n,m){if(n&1&&(i(0,"div",11),v(1,Pi,7,5,"div",56),o()),n&2){let e=c();a(),p("ngForOf",e.productToAdd==null?null:e.productToAdd.variants_records)}}function Hi(n,m){if(n&1){let e=x();i(0,"p-button",59),d("onClick",function(){u(e);let t=c();return _(t.variantDialogVisible=!1)}),o(),i(1,"p-button",60),d("onClick",function(){u(e);let t=c();return _(t.submitVariant())}),o()}}function Mi(n,m){if(n&1){let e=x();i(0,"div",61)(1,"div",62)(2,"label",63),l(3,"Delete Reason"),o(),i(4,"input",64),I("ngModelChange",function(t){u(e);let s=c();return E(s.deleteNote,t)||(s.deleteNote=t),_(t)}),o()()()}if(n&2){let e=c();a(4),w("ngModel",e.deleteNote)}}function Fi(n,m){if(n&1){let e=x();i(0,"p-button",65),d("onClick",function(){u(e);let t=c();return _(t.deleteDialogVisible=!1)}),o(),i(1,"p-button",66),d("onClick",function(){u(e);let t=c();return _(t.confirmDelete())}),o()}if(n&2){let e=c();a(),p("disabled",!e.deleteNote)("loading",e.loadingSubmitDelete)}}var pt=(()=>{class n{constructor(){this.visible=!1,this.customers=[],this.return_invoice_edit=!1,this.onSubmit=new be,this.onHide=new be,this.stockService=h(Te),this.editInvoiceService=h(Rt),this.authService=h(se),this.confirmationService=h(qe),this.notificationsService=h(j),this.sellService=h(Ft),this.fb=h(Ie),this.api=h(q),this.notification=h(j),this.customersService=h(K),this.userPermissions=this.authService.userPermissions,this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new nt,this.order_items=[],this.customer_id=null,this.pet_id=null,this.invoice_number="123",this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.update_reason=null,this.productsDialogVisible=!1,this.subscriptions=new Z,this.products=this.stockService.products,this.matching_products=[],this.priceTypes=Object.keys(Mt),this.editDialogVisible=!1,this.vh="50vh",this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null,this.deleteDialogVisible=!1,this.deleteNote=null,this.loadingSubmitDelete=!1}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1,this.update_reason=null)})),this.subscriptions.add(this.editInvoiceService.selectedCustomerLatestItems.subscribe(e=>{this.selectedCustomerLatestItems=e})),this.subscriptions.add(this.sellService.barcodeResponse.subscribe(e=>{e&&(this.addProduct(e),this.sellService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=(0,zt.default)(this.invoice.order_date).format("YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.order_items=structuredClone(this.invoice.items),this.customer_id=this.invoice.customer_id,this.pet_id=this.invoice.pet_id,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_amount,this.customerChange(this.invoice.customer_id))}setPrice(e){this.updatedRowIndex=e}onDiscountChange(e){this.updatedRowIndex=e}onEditComplete(e){e.field=="discount_percentage"?this.order_items=this.order_items.map((r,t)=>this.updatedRowIndex===t?Fe(Me({},r),{unit_price:parseFloat((r.original_price*(1-r.discount_percentage/100)).toFixed(2))}):r):e.field=="unit_price"&&(this.order_items=this.order_items.map((r,t)=>this.updatedRowIndex===t?Fe(Me({},r),{discount_percentage:parseFloat((100*(1-r.unit_price/r.original_price)).toFixed(2))}):r)),this.calculateTotal("edit")}setQty(e){this.calculateTotal("edit")}validateItems(){return!1}addProduct(e){this.productToAdd=e,e.has_variants?this.variantDialogVisible=!0:this.addProductToInvoice(e)}addProductToInvoice(e,r=null){let t=this.order_items.find(s=>s.product_id===e.product_id&&s.variant_id===r?.variant_id);t?(t.quantity+=1,this.calculateTotal("edit")):(this.order_items.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,original_price:e.unit_price_usd,unit_cost:e.unit_cost_usd,unit_price:e.unit_price_usd,quantity:1,variant_id:r?.variant_id,expiry_date:r?.expiry_date,stock_management:e.stock_management}),this.calculateTotal("add"))}submitVariant(){this.addProductToInvoice(this.productToAdd,this.selectedVariant),this.variantDialogVisible=!1}resetVariantsDialog(){this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}submitInvoiceInput(e){e.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.sellService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(e){if(e){let r=-1,t=["*","+"];for(let M=0;M<t.length;M++)if(e.indexOf(t[M])!==-1){r=e.indexOf(t[M]);break}let s=e.substring(0,r)||1,f=parseInt(e.substring(r+1,e.length));r!=-1&&r!=0?(this.sellService.factor.set(parseInt(s)),this.sellService.submitBarcode(f)):this.sellService.submitBarcode(e)}}calculateTotal(e){let r=new nt,t=this.order_items;return t.length>0&&(t.forEach(s=>{r.total_qty+=s.quantity,r.cost_dollar+=s.unit_cost*s.quantity,r.subtotal_dollar+=s.unit_price*s.quantity}),r.total_dollar=r.subtotal_dollar-r.discount_dollar),this.invoiceTotal=r,r}submitEditInvoice(){let e=this.validateItems();e?e&&this.notificationsService.showError("Please enter price for all items","home"):this.return_invoice_edit?this.editInvoiceService.returnCheckout({customer_id:this.customer_id,pet_id:this.pet_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.checkout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number,update_reason:this.update_reason},this.stockService)}searchItem(e){let r=this.products(),t=[],s=e.query;for(let f=0;f<r.length;f++){let M=r[f];M.product_name.toLowerCase().indexOf(s.toLowerCase())>-1&&t.push(M)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}customerChange(e){}removeRow(e){this.order_items.splice(e,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.order_items=[],this.submitted.set(!1),this.invoiceTotal=new nt}})}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(r=>{this.addProduct(r)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(!e.unit_price)return!1;let r=e.unit_cost||0,t=e.unit_price;return typeof r=="string"&&(r=parseFloat(r)),typeof t=="string"&&(t=parseFloat(t)),t<r}deleteInvoice(){this.deleteDialogVisible=!0}hideDeleteDialog(){this.deleteNote=null,this.deleteDialogVisible=!1}confirmDelete(){this.deleteNote&&(this.loadingSubmitDelete=!0,this.api.delete(`sell-orders/${this.invoice.order_id}?message=${this.deleteNote}`).pipe(Se(()=>{this.loadingSubmitDelete=!1,this.stockService.getItems(),this.customersService.getCustomerTotalBalance(this.invoice.customer_id),this.deleteDialogVisible=!1,this.visible=!1})).subscribe({next:e=>{this.notification.showSuccess(e.message,"home")}}))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["edit-invoice"]],inputs:{visible:"visible",invoice:"invoice",customers:"customers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Re],decls:10,vars:24,consts:[["invoiceTable",""],["barcodeInput",""],["editPrice",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","products"],["position","top","header","Choose Variant","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints","closeOnEscape","closable"],["pTemplate","content"],["header","Confirm","position","center",3,"visibleChange","onHide","visible","modal","closable"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","customer"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear"],[1,"col-12","md:col-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"onEditComplete","value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["for",""],["type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel"],["width","20%"],["width","40%"],["width","10%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","discount_percentage",3,"pEditableColumn"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","priceEditable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],["min","0.1","step","0.1",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","minFractionDigits"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","class","w-full mt-4 md:w-auto md:mt-0",3,"disabled","onClick",4,"ngIf"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",1,"w-full","mt-2","md:w-auto","md:ml-2",3,"onClick","disabled"],["size","small","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","loading","disabled"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"onClick","disabled"],["class","col-12 md:col-3",4,"ngFor","ngForOf"],[1,"col-12","md:col-3"],[1,"dark-hover","shadow-2","p-3","text-center","border-round",3,"click","ngClass"],["pRipple","","size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],["pRipple","","size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],[1,"formgrid","grid"],[1,"field","col-12"],["for","note"],["type","text","id","note","name","note","required","","pInputText","","spellcheck","false",1,"w-full","p-inputtext-sm",3,"ngModelChange","ngModel"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Proceed","icon","pi pi-check","severity","danger","size","small",3,"onClick","disabled","loading"]],template:function(r,t){r&1&&(i(0,"p-dialog",3),I("visibleChange",function(f){return E(t.visible,f)||(t.visible=f),f}),d("onHide",function(){return t.closeEditDialog()}),v(1,Ii,37,27,"ng-template",4)(2,Di,3,4,"ng-template",5),o(),i(3,"products-dialog",6),d("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(f){return t.assignSelectedProducts(f)}),o(),i(4,"p-dialog",7),I("visibleChange",function(f){return E(t.variantDialogVisible,f)||(t.variantDialogVisible=f),f}),d("onHide",function(){return t.resetVariantsDialog()}),v(5,Vi,2,1,"ng-template",8)(6,Hi,2,0,"ng-template",5),o(),i(7,"p-dialog",9),I("visibleChange",function(f){return E(t.deleteDialogVisible,f)||(t.deleteDialogVisible=f),f}),d("onHide",function(){return t.hideDeleteDialog()}),v(8,Mi,5,1,"ng-template",8)(9,Fi,2,2,"ng-template",5),o()),r&2&&(L(T(20,ai)),w("visible",t.visible),p("modal",!0)("closable",!0)("maximizable",!0),a(3),p("visible",t.productsDialogVisible)("products",t.products),a(),L(T(21,li)),w("visible",t.variantDialogVisible),p("modal",!0)("breakpoints",T(22,si))("closeOnEscape",!1)("closable",!0),a(3),L(T(23,pi)),w("visible",t.deleteDialogVisible),p("modal",!0)("closable",!0))},dependencies:[we,We,ee,A,B,Ae,Ee,De,H,k,Je,Xe,ie,O,N,ne,$,z,R,Ye,ot,F,rt],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:40px;height:28px}.priceEditable[_ngcontent-%COMP%]{width:60px;height:28px;text-align:center}[_nghost-%COMP%]  .p-inputnumber-input{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}[_nghost-%COMP%]  .small-button{font-size:.5rem!important;padding:.2rem .4rem!important;width:2rem!important}[_nghost-%COMP%]  .small-input>span>input{padding:.3rem!important;width:2rem!important;text-align:center}[_nghost-%COMP%]  .invoice-body>div>div{padding:0!important}[_nghost-%COMP%]  .p-dataview-emptymessage{display:none}[_nghost-%COMP%]  .p-card-content{padding:0!important}.invalid[_ngcontent-%COMP%]{border-color:var(--red-500)!important}.category-cards[_ngcontent-%COMP%]{border-radius:6px;color:#343a40;text-align:center;padding:.8rem;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}.selected[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}[_nghost-%COMP%]  .p-datatable{font-size:13px!important}[_nghost-%COMP%]  .p-card-body{padding:.8rem!important}[_nghost-%COMP%]  .maxHeight{height:100%!important}[_nghost-%COMP%]  .small-table{font-size:12px!important}"]})}}return n})();var ki=()=>[10,25,50],Lt=()=>({width:"95vw"});function Bi(n,m){n&1&&(i(0,"tr")(1,"th",23),l(2,"Invoice #"),o(),i(3,"th",24),l(4,"Customer"),o(),i(5,"th",25),l(6,"Pet"),o(),i(7,"th",25),l(8,"Datetime"),o(),i(9,"th",23),l(10,"total"),o(),i(11,"th",26),l(12,"Options"),o()())}function Ni(n,m){if(n&1){let e=x();i(0,"p-button",31),d("onClick",function(){u(e);let t=c().$implicit,s=c();return _(s.openEditDialog(t))}),o()}}function Oi(n,m){if(n&1){let e=x();i(0,"p-button",32),d("onClick",function(){u(e);let t=c().$implicit,s=c();return _(s.openEditHistoryDialog(t))}),o()}if(n&2){let e=c(2);p("loading",e.loadingEditHistory)}}function Ri(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),o(),i(9,"td"),l(10),C(11,"currency"),o(),i(12,"td")(13,"p-button",27),d("onClick",function(){let t=u(e).$implicit,s=c();return _(s.showInvoiceDialog(t))}),o()(),i(14,"td")(15,"p-button",28),d("onClick",function(){let t=u(e).$implicit,s=c();return _(s.printInvoice(t))}),o()(),i(16,"td"),v(17,Ni,1,0,"p-button",29),o(),i(18,"td"),v(19,Oi,1,1,"p-button",30),o()()}if(n&2){let e=m.$implicit,r=c();a(2),g(e.invoice_number),a(2),g(e.customer_name||"---"),a(2),g(e.pet_name||"---"),a(2),g(e.order_date),a(2),g(b(11,7,e.total_amount)),a(7),p("ngIf",r.userPermissions().edit_invoice),a(2),p("ngIf",e.update_reason)}}function zi(n,m){n&1&&(i(0,"tr")(1,"td",33),l(2,"No Records Found!"),o()())}function Wi(n,m){n&1&&(i(0,"th",39),l(1," Unit Cost "),o())}function Li(n,m){n&1&&(i(0,"th"),l(1,"Total Cost"),o())}function qi(n,m){if(n&1&&(i(0,"tr")(1,"th",25),l(2,"Barcode"),o(),i(3,"th",24),l(4,"Description"),o(),i(5,"th"),l(6,"Expiry Date"),o(),i(7,"th"),l(8,"Original Price"),o(),i(9,"th"),l(10,"Sold Price"),o(),i(11,"th"),l(12,"Discount %"),o(),i(13,"th",36),l(14,"Qty"),o(),i(15,"th"),l(16,"Total Price"),o(),v(17,Wi,2,0,"th",37)(18,Li,2,0,"th",38),o()),n&2){let e=c(3);a(17),p("ngIf",e.userPermissions().show_cost),a(),p("ngIf",e.userPermissions().show_cost)}}function Ai(n,m){if(n&1&&(i(0,"td",39),l(1),C(2,"currency"),o()),n&2){let e=c().$implicit;a(),S(" ",b(2,1,e.unit_cost)," ")}}function $i(n,m){if(n&1&&(i(0,"td"),l(1),C(2,"currency"),o()),n&2){let e=c().$implicit;a(),S(" ",b(2,1,e.unit_cost*e.quantity)," ")}}function ji(n,m){if(n&1&&(i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),C(9,"currency"),o(),i(10,"td"),l(11),C(12,"currency"),o(),i(13,"td"),l(14),o(),i(15,"td"),l(16),o(),i(17,"td"),l(18),C(19,"currency"),o(),v(20,Ai,3,3,"td",37)(21,$i,3,3,"td",38),o()),n&2){let e=m.$implicit,r=c(3);a(2),g(e.barcode||"---"),a(2),g(e.product_name),a(2),g(e.expiry_date||"---"),a(2),g(b(9,10,e.original_price)),a(3),S(" ",b(12,12,e.unit_price)," "),a(3),S("",e.discount_percentage,"%"),a(2),g(e.quantity),a(2),S(" ",b(19,14,e.total_price)," "),a(2),p("ngIf",r.userPermissions().show_cost),a(),p("ngIf",r.userPermissions().show_cost)}}function Gi(n,m){n&1&&y(0,"td",39)}function Ui(n,m){if(n&1&&(i(0,"td"),l(1),C(2,"currency"),o()),n&2){let e=c(4);a(),S(" ",b(2,1,e.selectedInvoiceTotals.totalCost)," ")}}function Qi(n,m){if(n&1&&(i(0,"tr"),y(1,"td")(2,"td")(3,"td")(4,"td")(5,"td")(6,"td"),i(7,"td"),l(8),o(),i(9,"td"),l(10),C(11,"currency"),o(),v(12,Gi,1,0,"td",37)(13,Ui,3,3,"td",38),o()),n&2){let e=c(3);a(8),g(e.selectedInvoiceTotals.totalQty),a(2),S(" ",b(11,4,e.selectedInvoiceTotals.totalPrice)," "),a(2),p("ngIf",e.userPermissions().show_cost),a(),p("ngIf",e.userPermissions().show_cost)}}function Yi(n,m){if(n&1&&(i(0,"p-table",35),v(1,qi,19,2,"ng-template",15)(2,ji,22,16,"ng-template",16)(3,Qi,14,6,"ng-template",20),o()),n&2){let e=c(2);p("value",e.invoiceItems)}}function Ki(n,m){if(n&1&&v(0,Yi,4,1,"p-table",34),n&2){let e=c();p("ngIf",e.invoiceItems.length!=0)}}function Ji(n,m){if(n&1){let e=x();i(0,"p-button",40),d("onClick",function(){u(e);let t=c();return _(t.hideInvoiceDialog())}),o()}}function Xi(n,m){n&1&&(i(0,"tr"),y(1,"th",43),i(2,"th"),l(3,"Created At"),o(),i(4,"th"),l(5,"Updated At"),o(),i(6,"th"),l(7,"Update Reason"),o(),i(8,"th"),l(9,"Total Price"),o()())}function Zi(n,m){if(n&1&&(i(0,"tr")(1,"td"),y(2,"p-button",44),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),o(),i(9,"td"),l(10),C(11,"currency"),o()()),n&2){let e=m.$implicit,r=m.expanded;a(2),p("pRowToggler",e)("text",!0)("rounded",!0)("plain",!0)("icon",r?"pi pi-chevron-down":"pi pi-chevron-right"),a(2),g(e.order_datetime),a(2),g(e.updated_at),a(2),g(e.update_reason),a(2),S(" ",b(11,9,e.total_amount)," ")}}function en(n,m){n&1&&(i(0,"tr")(1,"th"),l(2,"Description"),o(),y(3,"th")(4,"th")(5,"th"),o())}function tn(n,m){if(n&1&&(i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),C(5,"currency"),o(),i(6,"td"),l(7),o(),i(8,"td"),l(9),C(10,"currency"),o()()),n&2){let e=m.$implicit;a(2),g(e.product_name),a(2),S(" ",b(5,4,e.unit_price)," "),a(3),g(e.quantity),a(2),S(" ",b(10,6,e.total_price)," ")}}function nn(n,m){if(n&1&&(i(0,"tr")(1,"td",45)(2,"div",46)(3,"p-table",47),v(4,en,6,0,"ng-template",15)(5,tn,11,8,"ng-template",16),o()()()()),n&2){let e=m.$implicit;a(3),p("value",e.items)}}function on(n,m){if(n&1&&(i(0,"p-table",41),v(1,Xi,10,0,"ng-template",15)(2,Zi,12,11,"ng-template",16)(3,nn,6,1,"ng-template",42),o()),n&2){let e=c();p("value",e.editHistory)("expandedRowKeys",e.expandedRows)}}function rn(n,m){if(n&1){let e=x();i(0,"p-button",40),d("onClick",function(){u(e);let t=c();return _(t.editHistoryDialogVisible=!1)}),o()}}var qt=(()=>{class n{constructor(){this.customerService=h(K),this.historyService=h(X),this.decimalService=h(ce),this.printService=h(Ve),this.authService=h(se),this.whatsappService=h(st),this.api=h(q),this.userPermissions=this.authService.userPermissions,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new Z,this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new te({invoice_number:new D(null),customer_id:new D(null),start_date:new D(null),end_date:new D(null)}),this.whatsappLoading=this.whatsappService.whatsappLoading,this.editHistoryDialogVisible=!1,this.loadingEditHistory=!1,this.expandedRows={},this.submitSearch()}submitSearch(){this.historyService.fetchSalesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchSalesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost*r.quantity)}),this.detailsDialogVisible=!0}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchSalesHistory(this.searchForm.value)}printInvoice(e){this.printService.print(e,"sale")}sendWhatsapp(e){this.whatsappLoading.set(!0);let r={to:e.customer_phone,messageContents:[e.invoice_number,e.order_datetime,`${e.total_amount}$`]};this.whatsappService.sendMessage(r)}openEditHistoryDialog(e){this.loadingEditHistory=!0,this.api.get(`history/edits/${e.order_id}`).pipe(Se(()=>{this.loadingEditHistory=!1})).subscribe({next:r=>{console.log(r),this.editHistoryDialogVisible=!0,this.editHistory=r}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["app-sell-history"]],decls:29,vars:43,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"ngModelChange"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus","virtualScroll","virtualScrollItemSize"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","start_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Start Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["formControlName","end_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","End Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],[1,"col-12","md:col-6","lg:col-1"],["type","submit","label","search","icon","pi pi-search","size","small","severity","success","styleClass","w-full",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","w-full","size","small","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers"],["header","Edit History","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["width","10%"],["width","30%"],["width","15%"],["colspan","4","width","10%"],["size","small","severity","info","icon","fas fa-eye",3,"onClick"],["size","small","severity","secondary","icon","pi pi-print",3,"onClick"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick",4,"ngIf"],["size","small","severity","help","icon","pi pi-history",3,"loading","onClick",4,"ngIf"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["size","small","severity","help","icon","pi pi-history",3,"onClick","loading"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","5%"],["style","border-left: 1px #e5e7eb solid",4,"ngIf"],[4,"ngIf"],[2,"border-left","1px #e5e7eb solid"],["label","Close","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["dataKey","record_id","styleClass","p-datatable-sm",3,"value","expandedRowKeys"],["pTemplate","rowexpansion"],[2,"width","5rem"],["type","button",3,"pRowToggler","text","rounded","plain","icon"],["colspan","7"],[1,"p-3"],["dataKey","id",3,"value"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5)(7,"input",6),d("ngModelChange",function(){return t.submitSearch()}),o()(),i(8,"div",5),y(9,"p-dropdown",7),o(),i(10,"div",8),y(11,"p-calendar",9),o(),i(12,"div",8),y(13,"p-calendar",10),o(),i(14,"div",11),y(15,"p-button",12),o(),i(16,"div",11)(17,"p-button",13),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(18,"p-table",14),v(19,Bi,13,0,"ng-template",15)(20,Ri,20,9,"ng-template",16)(21,zi,3,0,"ng-template",17),o()()()(),i(22,"p-dialog",18),I("visibleChange",function(f){return E(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),d("onHide",function(){return t.hideInvoiceDialog()}),v(23,Ki,1,1,"ng-template",19)(24,Ji,1,0,"ng-template",20),o(),i(25,"edit-invoice",21),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),o(),i(26,"p-dialog",22),I("visibleChange",function(f){return E(t.editHistoryDialogVisible,f)||(t.editHistoryDialogVisible=f),f}),d("onHide",function(){return t.editHistory=null}),v(27,on,4,2,"ng-template",19)(28,rn,1,0,"ng-template",20),o()),r&2&&(a(3),p("toggleable",!0),a(),p("formGroup",t.searchForm),a(5),p("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("virtualScroll",!0)("virtualScrollItemSize",38),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),a(2),p("loading",t.loading()),a(2),p("disabled",t.loading()),a(),p("value",t.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",T(40,ki))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),L(T(41,Lt)),w("visible",t.detailsDialogVisible),p("modal",!0)("closable",!0)("maximizable",!0),a(3),p("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers()),a(),L(T(42,Lt)),w("visible",t.editHistoryDialogVisible),p("modal",!0)("closable",!0)("maximizable",!0))},dependencies:[ee,U,A,B,G,Q,Y,H,k,Dt,O,N,ne,$,z,R,J,pt,F]})}}return n})();var an=()=>[10,25,50];function ln(n,m){n&1&&(i(0,"tr")(1,"th"),l(2,"Payment #"),o(),i(3,"th"),l(4,"Customer"),o(),i(5,"th"),l(6,"Datetime"),o(),i(7,"th"),l(8,"total"),o(),i(9,"th",19),l(10,"Options"),o()())}function sn(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),C(9,"currency"),o(),i(10,"td")(11,"button",20),d("click",function(){let t=u(e).$implicit,s=c();return _(s.printInvoice(t))}),o()(),i(12,"td")(13,"button",21),d("click",function(){let t=u(e).$implicit,s=c();return _(s.openEditDialog(t))}),o()()()}if(n&2){let e=m.$implicit;a(2),g(e.journal_number),a(2),g(e.partner_name),a(2),g(e.payment_date),a(2),g(b(9,4,e.total_value))}}function pn(n,m){n&1&&(i(0,"tr")(1,"td",22),l(2,"No Records Found!"),o()())}var At=(()=>{class n{constructor(){this.customerService=h(K),this.historyService=h(X),this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new te({partner_id:new D(null),payment_number:new D(null),start_date:new D(null),end_date:new D(null)}),this.submitSearch()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.historyService.fetchPaymentHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}showInvoiceDialog(e){}printInvoice(e){}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){this.historyService.fetchPaymentHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["app-payment-history"]],decls:23,vars:28,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus","virtualScroll","virtualScrollItemSize"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","start_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Start Date",3,"showIcon","showClear","readonlyInput"],["formControlName","end_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","End Date",3,"showIcon","showClear","readonlyInput"],[1,"col-12","md:col-6","lg:col-1"],["type","submit","label","search","icon","pi pi-search","size","small","severity","success","styleClass","w-full",3,"loading"],["icon","pi pi-times","label","Clear","size","small","severity","danger","styleClass","w-full",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5),y(7,"input",6),o(),i(8,"div",5),y(9,"p-dropdown",7),o(),i(10,"div",8),y(11,"p-calendar",9),o(),i(12,"div",8),y(13,"p-calendar",10),o(),i(14,"div",11),y(15,"p-button",12),o(),i(16,"div",11)(17,"p-button",13),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(18,"p-table",14),v(19,ln,11,0,"ng-template",15)(20,sn,14,6,"ng-template",16)(21,pn,3,0,"ng-template",17),o()()()(),i(22,"payment-dialog",18),d("onClose",function(){return t.hidePaymentDialog()})("onSubmit",function(f){return t.getPaymentDilogResult(f)}),o()),r&2&&(a(3),p("toggleable",!0),a(),p("formGroup",t.searchForm),a(5),p("options",t.customers())("loading",t.customersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("virtualScroll",!0)("virtualScrollItemSize",38),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(2),p("loading",t.loading()),a(2),p("disabled",t.loading()),a(),p("value",t.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",T(27,an))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),p("visible",t.editDialogVisible)("selected_payment",t.selectedPayment)("accounts",t.customers()))},dependencies:[U,A,B,G,Q,Y,H,k,ie,O,N,$,z,R,J,et,F]})}}return n})();var $t=_t(Pt());var cn=()=>[10,25,50],mn=()=>({width:"95vw"});function dn(n,m){n&1&&(i(0,"tr")(1,"th"),l(2,"Invoice #"),o(),i(3,"th"),l(4,"Customer"),o(),i(5,"th"),l(6,"Datetime"),o(),i(7,"th"),l(8,"total"),o(),i(9,"th",19),l(10,"Options"),o()())}function un(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),C(9,"currency"),o(),i(10,"td")(11,"button",20),d("click",function(){let t=u(e).$implicit,s=c();return _(s.showInvoiceDialog(t))}),o()(),i(12,"td")(13,"button",21),d("click",function(){let t=u(e).$implicit,s=c();return _(s.printInvoice(t))}),o()(),i(14,"td")(15,"button",22),d("click",function(){let t=u(e).$implicit,s=c();return _(s.openEditDialog(t))}),o()()()}if(n&2){let e=m.$implicit;a(2),g(e.invoice_number),a(2),g(e.customer_name),a(2),g(e.order_date),a(2),g(b(9,4,e.total_amount))}}function _n(n,m){n&1&&(i(0,"tr")(1,"td",23),l(2,"No Records Found!"),o()())}function hn(n,m){n&1&&(i(0,"tr")(1,"th",26),l(2,"Description"),o(),i(3,"th",27),l(4,"Unit Price"),o(),i(5,"th",28),l(6,"Qty"),o(),i(7,"th",27),l(8,"Total Price"),o()())}function gn(n,m){if(n&1&&(i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),C(5,"currency"),o(),i(6,"td"),l(7),o(),i(8,"td"),l(9),C(10,"currency"),o()()),n&2){let e=m.$implicit;a(2),g(e.product_name),a(2),S(" ",b(5,4,e.unit_price)," "),a(3),g(e.quantity),a(2),S(" ",b(10,6,e.total_price)," ")}}function fn(n,m){if(n&1&&(i(0,"tr"),y(1,"td")(2,"td"),i(3,"td"),l(4),o(),i(5,"td"),l(6),C(7,"currency"),o()()),n&2){let e=c(3);a(4),g(e.selectedInvoiceTotals.totalQty),a(2),S(" Total: ",b(7,2,e.selectedInvoiceTotals.totalPrice)," ")}}function vn(n,m){if(n&1&&(i(0,"p-table",25),v(1,hn,9,0,"ng-template",12)(2,gn,11,8,"ng-template",13)(3,fn,8,4,"ng-template",17),o()),n&2){let e=c(2);p("value",e.invoiceItems)}}function yn(n,m){if(n&1&&v(0,vn,4,1,"p-table",24),n&2){let e=c();p("ngIf",e.invoiceItems.length!=0)}}function Cn(n,m){if(n&1){let e=x();i(0,"button",29),d("click",function(){u(e);let t=c();return _(t.hideInvoiceDialog())}),o()}}var jt=(()=>{class n{constructor(){this.customerService=h(K),this.historyService=h(X),this.decimalService=h(ce),this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new Z,this.returnHistory=this.historyService.returnHistory,this.loading=this.historyService.signal_loading,this.searchForm=new te({invoice_number:new D(null),customer_id:new D(null),invoice_date:new D(null)})}ngOnInit(){}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,$t.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchReturnHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(e){}printDelivery(e){}openEditDialog(e){console.log(e),this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchReturnHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers","return_invoice_edit"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5),y(7,"p-dropdown",6),o(),i(8,"div",5),y(9,"p-calendar",7),o(),i(10,"div",5),y(11,"input",8),o(),i(12,"div",5),y(13,"p-button",9),i(14,"p-button",10),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(15,"p-table",11),v(16,dn,11,0,"ng-template",12)(17,un,16,6,"ng-template",13)(18,_n,3,0,"ng-template",14),o()()()(),i(19,"p-dialog",15),I("visibleChange",function(f){return E(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),d("onHide",function(){return t.hideInvoiceDialog()}),v(20,yn,1,1,"ng-template",16)(21,Cn,1,0,"ng-template",17),o(),i(22,"edit-invoice",18),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),o()),r&2&&(a(3),p("toggleable",!0),a(),p("formGroup",t.searchForm),a(3),p("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(4),p("loading",t.loading()),a(),p("disabled",t.loading()),a(),p("value",t.returnHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",T(28,cn))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),L(T(29,mn)),w("visible",t.detailsDialogVisible),p("modal",!0)("closable",!0)("maximizable",!0),a(3),p("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers())("return_invoice_edit",!0))},dependencies:[ee,U,A,B,G,Q,Y,H,k,ie,O,N,ne,$,z,R,J,pt,F]})}}return n})();var Gt=(()=>{class n{constructor(){this.apiService=h(q),this.http=h(le),this.notificationService=h(j),this.suppliersService=h(Pe),this.host=this.apiService.host,this.currentInvoice=P({}),this.signal_submited=P(!1),this.signal_submit_loading=P(!1),this.action_status$=new Ce(""),this.selectedSupplierLatestItems=new Ce([])}chcekout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/supply`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk)}})}returnCheckout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk)}})}deleteInvoice(e,r){let t=e.order_id;console.log(t),this.signal_submited.set(!0),this.http.delete(`${this.host}/supply/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk)}})}returnDeleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk)}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=re({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Sn=()=>({width:"95vw",height:"75vh"}),bn=()=>({width:"65vw"}),xn=()=>({"1199px":"75vw","575px":"95vw"}),wn=()=>({standalone:!0}),En=n=>({"ng-invalid ng-dirty":n}),Ut=n=>({invalid:n}),In=(n,m)=>({"text-red-500":n,"text-orange-500":m}),Tn=n=>({"text-red-500":n}),Dn=n=>({selected:n});function Pn(n,m){n&1&&(i(0,"small",29),l(1,"Supplier is required."),o())}function Vn(n,m){n&1&&(i(0,"tr")(1,"th",30),l(2,"Barcode"),o(),i(3,"th",31),l(4,"Description"),o(),i(5,"th",32),l(6,"Expiry Date"),o(),i(7,"th",33),l(8,"Unit"),o(),i(9,"th",34),l(10,"Qty"),o(),i(11,"th",33),l(12,"Total"),o(),i(13,"th",34),l(14,"Del?"),o()())}function Hn(n,m){if(n&1){let e=x();i(0,"p-inputNumber",41),I("ngModelChange",function(t){u(e);let s=c().$implicit;return E(s.unit_price,t)||(s.unit_price=t),_(t)}),d("ngModelChange",function(){u(e);let t=c().$implicit,s=c(2);return _(s.setPrice(t))})("onFocus",function(t){u(e);let s=c(3);return _(s.select(t.target))}),o()}if(n&2){let e=c().$implicit;w("ngModel",e.unit_price),p("maxFractionDigits",3)("min",0)}}function Mn(n,m){n&1&&y(0,"i",44)}function Fn(n,m){if(n&1&&(i(0,"span",42),l(1),C(2,"currency"),i(3,"span"),v(4,Mn,1,0,"i",43),o()()),n&2){let e=c().$implicit,r=c(2);p("ngClass",xe(8,In,!e.unit_price,r.getPriceWarining(e))),a(),g(oe(2,3,e.unit_price,"USD","symbol","1.3-3")),a(3),p("ngIf",r.getPriceWarining(e))}}function kn(n,m){if(n&1){let e=x();i(0,"p-inputNumber",45),I("ngModelChange",function(t){u(e);let s=c().$implicit;return E(s.quantity,t)||(s.quantity=t),_(t)}),d("onFocus",function(t){u(e);let s=c(3);return _(s.select(t.target))})("ngModelChange",function(){u(e);let t=c().$implicit,s=c(2);return _(s.setQty(t))}),o()}if(n&2){let e=c().$implicit;w("ngModel",e.quantity)}}function Bn(n,m){if(n&1&&(i(0,"span",42),l(1),o()),n&2){let e=c().$implicit;p("ngClass",ae(2,Tn,!e.quantity)),a(),g(e.quantity)}}function Nn(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td",35)(8,"p-cellEditor"),v(9,Hn,1,3,"ng-template",36)(10,Fn,5,11,"ng-template",37),o()(),i(11,"td",38)(12,"p-cellEditor"),v(13,kn,1,1,"ng-template",36)(14,Bn,2,4,"ng-template",37),o()(),i(15,"td"),l(16),C(17,"currency"),o(),i(18,"td",39),d("click",function(){let t=u(e).rowIndex,s=c(2);return _(s.removeRow(t))}),y(19,"i",40),o()()}if(n&2){let e=m.$implicit;a(2),g(e.barcode||"---"),a(2),g(e.product_name),a(2),g(e.expiry_date||"---"),a(),p("pEditableColumn",e.unit_price)("ngClass",ae(13,Ut,!e.unit_price)),a(4),p("pEditableColumn",e.quantity)("ngClass",ae(15,Ut,!e.quantity)),a(5),S(" ",oe(17,8,e.unit_price*e.quantity,"USD","symbol","1.3-3")," ")}}function On(n,m){if(n&1&&(i(0,"h4",47),l(1),o()),n&2){let e=c(3);a(),S(" Total units: ",e.invoiceTotal.total_qty," ")}}function Rn(n,m){if(n&1&&v(0,On,2,1,"h4",46),n&2){let e=c(2);p("ngIf",e.invoiceTotal.total_qty)}}function zn(n,m){n&1&&(i(0,"tr",48)(1,"td",49),l(2,"No data yet!"),o()())}function Wn(n,m){if(n&1){let e=x();i(0,"p-card",8)(1,"div",9)(2,"div",10)(3,"div",11),y(4,"div",12),i(5,"label"),l(6,"Invoice Date"),o(),i(7,"p-calendar",13),I("ngModelChange",function(t){u(e);let s=c();return E(s.invoice_date,t)||(s.invoice_date=t),_(t)}),o()()(),i(8,"div",10)(9,"div",12)(10,"label",14),l(11,"Supplier"),i(12,"span",15),l(13," *"),o()(),i(14,"p-dropdown",16),I("ngModelChange",function(t){u(e);let s=c();return E(s.supplier_id,t)||(s.supplier_id=t),_(t)}),d("onChange",function(t){u(e);let s=c();return _(s.supplierChange(t.value))}),o(),v(15,Pn,2,0,"small",17),o()(),i(16,"div",18)(17,"h3",19),l(18),C(19,"currency"),o(),i(20,"h3",20),l(21),C(22,"lira"),o()()(),i(23,"div",9)(24,"div",21)(25,"p-table",22,0),v(27,Vn,15,0,"ng-template",23)(28,Nn,20,17,"ng-template",3)(29,Rn,1,1,"ng-template",24)(30,zn,3,0,"ng-template",25),o()(),i(31,"div",26)(32,"p-autoComplete",27,1),I("ngModelChange",function(t){u(e);let s=c();return E(s.search_product,t)||(s.search_product=t),_(t)}),d("completeMethod",function(t){u(e);let s=c();return _(s.searchItem(t))})("onKeyUp",function(t){u(e);let s=c();return _(s.submitInvoiceInput(t))}),o(),i(34,"button",28),d("click",function(){u(e);let t=c();return _(t.openProductsDialog())}),o()()()()}if(n&2){let e=c();a(7),w("ngModel",e.invoice_date),p("ngModelOptions",T(28,wn))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),a(7),w("ngModel",e.supplier_id),p("options",e.suppliers)("filter",!0)("showClear",!0)("ngClass",ae(29,En,!e.supplier_id)),a(),p("ngIf",!e.supplier_id),a(3),S(" USD: ",oe(19,21,e.invoiceTotal.total_dollar,"USD","symbol","1.3-3")," "),a(3),S(" LBP: ",b(22,26,e.invoiceTotal.total_dollar*e.invoice.exchange_rate)," "),a(4),ze("scrollHeight",e.vh),p("value",e.invoice_items())("scrollable",!0),a(7),w("ngModel",e.search_product),p("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function Ln(n,m){if(n&1){let e=x();i(0,"p-button",50),d("onClick",function(){u(e);let t=c();return _(t.deleteInvoice())}),o(),i(1,"p-button",51),d("onClick",function(){u(e);let t=c();return _(t.closeEditDialog())}),o(),i(2,"p-button",52),d("onClick",function(){u(e);let t=c();return _(t.submitEditInvoice())}),o()}if(n&2){let e=c();p("disabled",e.submitted()),a(),p("disabled",e.submitted()),a(),p("loading",e.submitted())("disabled",e.invoice_items().length==0)}}function qn(n,m){if(n&1){let e=x();i(0,"div",54)(1,"div",55),d("click",function(){let t=u(e).$implicit,s=c(2);return _(s.selectedVariant=t)}),i(2,"p"),l(3),y(4,"br"),i(5,"small"),l(6),o()()()()}if(n&2){let e=m.$implicit,r=c(2);a(),p("ngClass",ae(3,Dn,r.selectedVariant==e)),a(2),S(" ",e.expiry_date," "),a(3),S("Current qty: ",e.variant_quantity,"")}}function An(n,m){if(n&1&&(i(0,"div",9),v(1,qn,7,5,"div",53),o()),n&2){let e=c();a(),p("ngForOf",e.productToAdd==null?null:e.productToAdd.variants_records)}}function $n(n,m){if(n&1){let e=x();i(0,"p-button",56),d("onClick",function(){u(e);let t=c();return _(t.variantDialogVisible=!1)}),o(),i(1,"p-button",57),d("onClick",function(){u(e);let t=c();return _(t.submitVariant())}),o()}}var Qt=(()=>{class n{constructor(){this.visible=!1,this.suppliers=[],this.return_invoice_edit=!1,this.onSubmit=new be,this.onHide=new be,this.stockService=h(Te),this.editInvoiceService=h(Gt),this.authService=h(se),this.confirmationService=h(qe),this.notificationsService=h(j),this.supplyService=h(Bt),this.dateService=h(pe),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new at,this.supplier_id=null,this.invoice_number="123",this.invoice_items=P([]),this.selectedSupplierLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new Z,this.products=this.stockService.products,this.matching_products=[],this.editDialogVisible=!1,this.vh="50vh",this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.supplyService.barcodeResponse.subscribe(e=>{e&&(this.addProduct(e),this.supplyService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.invoice_items.set(structuredClone(this.invoice.items)),this.supplier_id=this.invoice.partner_id_fk,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_cost,this.supplierChange(this.invoice.supplier_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.invoice_items().find(r=>!r.unit_price||!r.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){this.productToAdd=e,e.has_variants?this.variantDialogVisible=!0:this.addProductToInvoice(e)}addProductToInvoice(e,r=null){let t=this.supplyService.factor(),s=structuredClone(this.invoice_items()),f=s.find(M=>M.product_id===e.product_id&&M.variant_id===r?.variant_id);f?f.quantity+=t:s.push({product_id:e.product_id,variant_id:r?.variant_id,expiry_date:r?.expiry_date,barcode:e.barcode,product_name:e.product_name,unit_cost:e.unit_cost_usd,unit_price:e.unit_cost_usd,quantity:t,unit_abbreviation:e.unit_abbreviation,product_unit_id:e.unit_id_fk}),this.invoice_items.set(s),this.supplyService.factor.set(1),this.calculateTotal("add")}submitVariant(){this.addProductToInvoice(this.productToAdd,this.selectedVariant),this.variantDialogVisible=!1}resetVariantsDialog(){this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}submitInvoiceInput(e){e.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.supplyService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(e){if(e){let r=-1,t=["*","+"];for(let M=0;M<t.length;M++)if(e.indexOf(t[M])!==-1){r=e.indexOf(t[M]);break}let s=e.substring(0,r)||1,f=parseInt(e.substring(r+1,e.length));r!=-1&&r!=0?(this.supplyService.factor.set(parseInt(s)),this.supplyService.submitBarcode(f)):this.supplyService.submitBarcode(e)}}calculateTotal(e){let r=new at,t=this.invoice_items();return t.length>0&&(t.forEach(s=>{r.total_qty+=s.quantity,r.cost_dollar+=s.unit_cost*s.quantity,r.subtotal_dollar+=s.unit_price*s.quantity}),r.total_dollar=r.subtotal_dollar-r.discount_dollar),this.invoiceTotal=r,r}submitEditInvoice(){let e=this.validateItems();!e&&this.supplier_id?this.return_invoice_edit?this.editInvoiceService.returnCheckout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):e&&this.notificationsService.showError("Please enter price for all items","home")}searchItem(e){let r=this.products(),t=[],s=e.query;for(let f=0;f<r.length;f++){let M=r[f];M.product_name.toLowerCase().indexOf(s.toLowerCase())>-1&&t.push(M)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}supplierChange(e){}removeRow(e){this.invoice_items().splice(e,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoice_items.set([]),this.submitted.set(!1),this.invoiceTotal=new at}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(r=>{this.addProduct(r)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(!e.unit_price)return!1;let r=e.unit_cost||0,t=e.unit_price;return typeof r=="string"&&(r=parseFloat(r)),typeof t=="string"&&(t=parseFloat(t)),t<r}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["edit-purchase"]],inputs:{visible:"visible",invoice:"invoice",suppliers:"suppliers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Re],decls:7,vars:18,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],["price","cost",3,"onHide","onSubmit","visible","products"],["position","top","header","Choose Variant","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints","closeOnEscape","closable"],["pTemplate","content"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","ngClass"],["class","p-error",4,"ngIf"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],[1,"p-error"],["width","20%"],["width","35%"],["width","15%"],["width","10%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",3,"onClick","disabled"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",3,"onClick","disabled"],["label","Submit Edit","icon","pi pi-check","severity","success","size","small",3,"onClick","loading","disabled"],["class","col-12 md:col-3",4,"ngFor","ngForOf"],[1,"col-12","md:col-3"],[1,"dark-hover","shadow-2","p-3","text-center","border-round",3,"click","ngClass"],["size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],["size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"]],template:function(r,t){r&1&&(i(0,"p-dialog",2),I("visibleChange",function(f){return E(t.visible,f)||(t.visible=f),f}),d("onHide",function(){return t.closeEditDialog()}),v(1,Wn,35,31,"ng-template",3)(2,Ln,3,4,"ng-template",4),o(),i(3,"products-dialog",5),d("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(f){return t.assignSelectedProducts(f)}),o(),i(4,"p-dialog",6),I("visibleChange",function(f){return E(t.variantDialogVisible,f)||(t.variantDialogVisible=f),f}),d("onHide",function(){return t.resetVariantsDialog()}),v(5,An,2,1,"ng-template",7)(6,$n,2,0,"ng-template",4),o()),r&2&&(L(T(15,Sn)),w("visible",t.visible),p("modal",!0)("closable",!0)("maximizable",!0),a(3),p("visible",t.productsDialogVisible)("products",t.products),a(),L(T(16,bn)),w("visible",t.variantDialogVisible),p("modal",!0)("breakpoints",T(17,xn))("closeOnEscape",!1)("closable",!0))},dependencies:[we,We,ee,B,Ee,De,H,k,Je,Xe,ie,O,N,ne,z,R,Ye,ot,F,rt],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}.selected[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}"]})}}return n})();var Gn=()=>[10,25,50],Un=()=>({width:"95vw"});function Qn(n,m){n&1&&(i(0,"tr")(1,"th"),l(2,"Invoice #"),o(),i(3,"th"),l(4,"Supplier"),o(),i(5,"th"),l(6,"Datetime"),o(),i(7,"th"),l(8,"total"),o(),i(9,"th",22),l(10,"Options"),o()())}function Yn(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),C(9,"currency"),o(),i(10,"td")(11,"button",23),d("click",function(){let t=u(e).$implicit,s=c();return _(s.showInvoiceDialog(t))}),o()(),i(12,"td")(13,"button",24),d("click",function(){let t=u(e).$implicit,s=c();return _(s.openEditDialog(t))}),o()()()}if(n&2){let e=m.$implicit;a(2),g(e.invoice_number),a(2),g(e.supplier_name||"---"),a(2),g(e.order_date),a(2),S(" ",oe(9,4,e.total_cost,"USD","symbol","1.3-3")," ")}}function Kn(n,m){n&1&&(i(0,"tr")(1,"td",25),l(2,"No Records Found!"),o()())}function Jn(n,m){n&1&&(i(0,"tr")(1,"th",28),l(2,"Barcode"),o(),i(3,"th",29),l(4,"Description"),o(),i(5,"th",28),l(6,"Expiry Date"),o(),i(7,"th",30),l(8,"Unit Price"),o(),i(9,"th",31),l(10,"Qty"),o(),i(11,"th",30),l(12,"Total Price"),o()())}function Xn(n,m){if(n&1&&(i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),C(9,"currency"),o(),i(10,"td"),l(11),o(),i(12,"td"),l(13),C(14,"currency"),o()()),n&2){let e=m.$implicit;a(2),g(e.barcode||"---"),a(2),g(e.product_name),a(2),g(e.expiry_date||"---"),a(2),S(" ",oe(9,6,e.unit_cost,"USD","symbol","1.3-3")," "),a(3),g(e.quantity),a(2),S(" ",oe(14,11,e.unit_cost*e.quantity,"USD","symbol","1.3-3")," ")}}function Zn(n,m){if(n&1&&(i(0,"tr"),y(1,"td")(2,"td")(3,"td")(4,"td"),i(5,"td"),l(6),o(),i(7,"td"),l(8),C(9,"currency"),o()()),n&2){let e=c(3);a(6),g(e.selectedInvoiceTotals.totalQty),a(2),S(" ",oe(9,2,e.selectedInvoiceTotals.totalCost,"USD","symbol","1.3-3")," ")}}function eo(n,m){if(n&1&&(i(0,"p-table",27),v(1,Jn,13,0,"ng-template",15)(2,Xn,15,16,"ng-template",16)(3,Zn,10,7,"ng-template",20),o()),n&2){let e=c(2);p("value",e.invoiceItems)}}function to(n,m){if(n&1&&v(0,eo,4,1,"p-table",26),n&2){let e=c();p("ngIf",e.invoiceItems.length!=0)}}function io(n,m){if(n&1){let e=x();i(0,"p-button",32),d("onClick",function(){u(e);let t=c();return _(t.hideInvoiceDialog())}),o()}}var Yt=(()=>{class n{constructor(){this.suppliersService=h(Pe),this.historyService=h(X),this.decimalService=h(ce),this.printService=h(Ve),this.suppliers=[],this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0},this.subscriptions=new Z,this.purchasesHistory=this.historyService.purchasesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new te({invoice_number:new D(null),supplier_id:new D(null),start_date:new D(null),end_date:new D(null)}),this.submitSearch()}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(e=>{this.suppliers=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.historyService.fetchPurchasesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPurchasesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{console.log(r),this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost*r.quantity)}),this.detailsDialogVisible=!0}printDelivery(e){}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0}}submitEdit(e){this.historyService.fetchPurchasesHistory(this.searchForm.value)}printInvoice(e){this.printService.print(e,"sale")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["app-supply-history"]],decls:26,vars:34,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","supplier_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","start_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Start Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["formControlName","end_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","End Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],[1,"col-12","md:col-6","lg:col-1"],["type","submit","label","search","icon","pi pi-search","size","small","severity","success","styleClass","w-full",3,"loading"],["icon","pi pi-times","label","Clear","size","small","severity","danger","styleClass","w-full",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","suppliers"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","20%"],["width","35%"],["width","10%"],["width","5%"],["size","small","label","Close","icon","pi pi-times","severity","secondary",3,"onClick"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5),y(7,"input",6),o(),i(8,"div",5),y(9,"p-dropdown",7),o(),i(10,"div",8),y(11,"p-calendar",9),o(),i(12,"div",8),y(13,"p-calendar",10),o(),i(14,"div",11),y(15,"p-button",12),o(),i(16,"div",11)(17,"p-button",13),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(18,"p-table",14),v(19,Qn,11,0,"ng-template",15)(20,Yn,14,9,"ng-template",16)(21,Kn,3,0,"ng-template",17),o()()()(),i(22,"p-dialog",18),I("visibleChange",function(f){return E(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),d("onHide",function(){return t.hideInvoiceDialog()}),v(23,to,1,1,"ng-template",19)(24,io,1,0,"ng-template",20),o(),i(25,"edit-purchase",21),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),o()),r&2&&(a(3),p("toggleable",!0),a(),p("formGroup",t.searchForm),a(5),p("options",t.suppliers)("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),a(2),p("loading",t.loading()),a(2),p("disabled",t.loading()),a(),p("value",t.purchasesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",T(32,Gn))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),L(T(33,Un)),w("visible",t.detailsDialogVisible),p("modal",!0)("closable",!0)("maximizable",!0),a(3),p("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("suppliers",t.suppliers))},dependencies:[ee,U,A,B,G,Q,Y,H,k,ie,O,N,ne,$,z,R,J,Qt,F]})}}return n})();var no=()=>[10,25,50];function oo(n,m){n&1&&(i(0,"tr")(1,"th",22),l(2,"Payment #"),o(),i(3,"th",23),l(4,"Supplier"),o(),i(5,"th",24),l(6," Datetime "),y(7,"p-sortIcon",25),o(),i(8,"th",22),l(9,"Total"),o(),i(10,"th"),l(11,"Notes"),o(),i(12,"th",26),l(13,"Options"),o()())}function ro(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),C(9,"currency"),o(),i(10,"td"),l(11),o(),i(12,"td"),y(13,"p-button",27),o(),i(14,"td")(15,"p-button",28),d("onClick",function(){let t=u(e).$implicit,s=c();return _(s.openEditDialog(t))}),o()()()}if(n&2){let e=m.$implicit;a(2),g(e.journal_number),a(2),g(e.partner_name),a(2),g(e.payment_date),a(2),S(" ",oe(9,5,e.total_value,"USD","symbol","1.3-3")," "),a(3),g(e.journal_notes||"---")}}function ao(n,m){n&1&&(i(0,"tr")(1,"td",29),l(2,"No Records Found!"),o()())}var Kt=(()=>{class n{constructor(){this.suppliersService=h(Pe),this.historyService=h(X),this.dateService=h(pe),this.cols=[{field:"journal_number",header:"Expense #"},{field:"partner_name",header:"Supplier"},{field:"total_value",header:"Total"},{field:"payment_date",header:"Datetime"}],this.suppliers=[],this.suppliersLoading=this.suppliersService.suppliersLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new Z,this.receiptsHistory=this.historyService.receiptsHistory,this.loading=this.historyService.signal_loading,this.totalValue=St(()=>this.receiptsHistory().reduce((e,r)=>e+parseFloat(r.total_value),0)),this.searchForm=new te({partner_id:new D(null),payment_number:new D(null),start_date:new D(null),end_date:new D(null)}),this.submitSearch()}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(e=>{this.suppliers=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.historyService.fetchReceiptsHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReceiptsHistory(null)}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){this.historyService.fetchReceiptsHistory(this.searchForm.value)}exportCSV(){let e=[...this.rt.value],r=[];this.rt.filteredValue&&(r=[...this.rt.filteredValue]);let t=[];this.rt.filteredValue?t=[...this.rt.filteredValue]:t=[...this.rt.value];let s=t.map(f=>{let mt=(f.payment_date?f.payment_date.toString():"").substring(0,10),Be=mt.split("-");return Be.length===3&&(mt=`${Be[1]}/${Be[2]}/${Be[0]}`),Fe(Me({},f),{payment_date:mt})});this.rt.value=s,this.rt.filteredValue&&(this.rt.filteredValue=s),this.rt?.exportCSV(),this.rt.filteredValue&&(this.rt.filteredValue=r),this.rt.value=e}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["app-supplier-payments"]],viewQuery:function(r,t){if(r&1&&gt(H,5),r&2){let s;ft(s=vt())&&(t.rt=s.first)}},decls:29,vars:33,consts:[["rt",""],[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"ngModelChange"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","options","loading","filter","showClear","autoOptionFocus"],["formControlName","start_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Start Date",3,"ngModelChange","showIcon","showClear","readonlyInput"],["formControlName","end_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","End Date",3,"ngModelChange","showIcon","showClear","readonlyInput"],[1,"col-12","md:col-6","lg:col-1"],["type","submit","label","search","icon","pi pi-search","size","small","severity","success","styleClass","w-full",3,"loading"],["icon","pi pi-times","label","Clear","size","small","severity","danger","styleClass","w-full",3,"onClick","disabled"],["icon","pi pi-file-excel","label","Export","size","small","severity","success","styleClass","w-full",3,"onClick","disabled","outlined"],[1,"text-center"],["dataKey","order_id","styleClass","p-datatable-sm",3,"exportHeader","columns","value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["width","15%"],["width","20%"],["width","20%","pSortableColumn","payment_date"],["field","payment_date"],["colspan","2","width","10%"],["size","small","severity","secondary","icon","pi pi-print","disabled",""],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["colspan","11"]],template:function(r,t){if(r&1){let s=x();i(0,"div",1)(1,"div",2)(2,"p-card")(3,"p-fieldset",3)(4,"form",4),d("ngSubmit",function(){return u(s),_(t.submitSearch())}),i(5,"div",5)(6,"div",6)(7,"input",7),d("ngModelChange",function(){return u(s),_(t.submitSearch())}),o()(),i(8,"div",8)(9,"p-dropdown",9),d("ngModelChange",function(){return u(s),_(t.submitSearch())}),o()(),i(10,"div",6)(11,"p-calendar",10),d("ngModelChange",function(){return u(s),_(t.submitSearch())}),o()(),i(12,"div",6)(13,"p-calendar",11),d("ngModelChange",function(){return u(s),_(t.submitSearch())}),o()(),i(14,"div",12),y(15,"p-button",13),o(),i(16,"div",12)(17,"p-button",14),d("onClick",function(){return u(s),_(t.resetSearch())}),o()(),i(18,"div",12)(19,"p-button",15),d("onClick",function(){return u(s),_(t.exportCSV())}),o()()()()(),i(20,"h3",16),l(21),C(22,"currency"),o(),i(23,"p-table",17,0),v(25,oo,14,0,"ng-template",18)(26,ro,16,10,"ng-template",19)(27,ao,3,0,"ng-template",20),o()()()(),i(28,"supplier-payment-dialog",21),d("onClose",function(){return u(s),_(t.hidePaymentDialog())})("onSubmit",function(M){return u(s),_(t.getPaymentDilogResult(M))}),o()}r&2&&(a(3),p("toggleable",!0),a(),p("formGroup",t.searchForm),a(5),p("options",t.suppliers)("loading",t.suppliersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(2),p("loading",t.loading()),a(2),p("disabled",t.loading()),a(2),p("disabled",t.loading())("outlined",!0),a(2),S(" Total Value: ",b(22,30,t.totalValue())," "),a(2),p("exportHeader","Receipts History")("columns",t.cols)("value",t.receiptsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",T(32,no))("alwaysShowPaginator",!1)("loading",t.loading()),a(5),p("visible",t.editDialogVisible)("selected_payment",t.selectedPayment)("accounts",t.suppliers))},dependencies:[U,A,B,G,Q,Y,H,k,It,Tt,O,N,$,z,R,J,lt,F]})}}return n})();var Jt=(()=>{class n{constructor(){this.api=h(q),this.notificationService=h(j),this.http=h(le),this.dateService=h(pe),this.startDate=P(this.dateService.getStartOfMonth()),this.endDate=P(this.dateService.getCurrentDate()),this.loadingTransactions=P(!1),this.cashTransactions=P([])}startDateChanged(){this.startDate.set(this.dateService.formatDate(this.startDate(),"YYYY-MM-DD"))}getCashTransactions(e,r){this.loadingTransactions.set(!0),e=this.dateService.formatDate(e,"YYYY-MM-DD"),r=this.dateService.formatDate(r,"YYYY-MM-DD"),this.http.get(`${this.api.host}/balance/transactions/${e}&${r}`).subscribe({next:t=>{this.cashTransactions.set(t),this.loadingTransactions.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.loadingTransactions.set(!1)}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=re({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var lo=(n,m)=>({"text-300":n,"text-green-600":m}),so=(n,m)=>({"text-300":n,"text-red-600":m}),po=(n,m,e)=>({"text-red-600":n,"text-green-600":m,"font-bold":e}),co=(n,m)=>({"text-red-600":n,"text-green-600":m});function mo(n,m){if(n&1){let e=x();i(0,"label",9),l(1,"Start Date:"),o(),i(2,"p-calendar",10),I("ngModelChange",function(t){u(e);let s=c();return E(s.startDate,t)||(s.startDate=t),_(t)}),d("onSelect",function(){u(e);let t=c();return _(t.startDateChanged())}),o()}if(n&2){let e=c();a(2),w("ngModel",e.startDate),p("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function uo(n,m){if(n&1){let e=x();i(0,"label",9),l(1,"End Date:"),o(),i(2,"p-calendar",10),I("ngModelChange",function(t){u(e);let s=c();return E(s.endDate,t)||(s.endDate=t),_(t)}),d("onSelect",function(){u(e);let t=c();return _(t.endDateChanged())}),o()}if(n&2){let e=c();a(2),w("ngModel",e.endDate),p("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function _o(n,m){if(n&1){let e=x();i(0,"p-button",11),d("onClick",function(){u(e);let t=c();return _(t.selectToday())}),o(),i(1,"p-button",12),d("onClick",function(){u(e);let t=c();return _(t.selectThisMonth())}),o(),i(2,"p-button",13),d("onClick",function(){u(e);let t=c();return _(t.selectThisYear())}),o()}n&2&&(p("size","small"),a(),p("size","small"),a(),p("size","small"))}function ho(n,m){n&1&&(i(0,"tr")(1,"th",14),l(2,"Date"),o(),i(3,"th",14),l(4,"Transaction"),o(),i(5,"th",15),l(6,"Description"),o(),i(7,"th",15),l(8,"Debit"),o(),i(9,"th",15),l(10,"Credit"),o(),i(11,"th",15),l(12,"Balance"),o()())}function go(n,m){if(n&1&&(i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td",16),l(8),C(9,"currency"),o(),i(10,"td",16),l(11),C(12,"currency"),o(),i(13,"td",16),l(14),C(15,"currency"),o()()),n&2){let e=m.$implicit,r=m.rowIndex,t=c();a(2),S(" ",e.journal_date||"Before "+t.startDate()," "),a(2),g(e.journal_number||"---"),a(2),g(e.journal_description||"---"),a(),p("ngClass",xe(15,lo,e.debit==0,e.debit!=0)),a(),S(" ",b(9,9,e.debit)," "),a(2),p("ngClass",xe(18,so,e.credit==0,e.credit!=0)),a(),S(" ",b(12,11,e.credit)," "),a(2),p("ngClass",Ct(21,po,t.balances[r]<0,t.balances[r]>0,t.balances[r]==0)),a(),S(" ",b(15,13,t.balances[r])," ")}}function fo(n,m){if(n&1&&(i(0,"tr"),y(1,"td",17),i(2,"td"),l(3,"Balance Due"),o(),i(4,"td",16),l(5),C(6,"currency"),o()()),n&2){let e=c();a(4),p("ngClass",xe(4,co,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),a(),S(" ",b(6,2,e.balances[e.balances.length-1])," ")}}var ct=(()=>{class n{constructor(){this.transactionService=h(Jt),this.fb=h(Ie),this.dateService=h(pe),this.decimalService=h(ce),this.loadingTransactions=this.transactionService.loadingTransactions,this.cashTransactions=this.transactionService.cashTransactions,this.startDate=this.transactionService.startDate,this.endDate=this.transactionService.endDate,this.balances=[],this.submitSearch(),bt(()=>{let e=this.cashTransactions();if(console.log(e),e.length>0){this.balances=[],this.balances[0]=parseFloat(e[0].balance);for(let r=1;r<e.length;r++)this.balances[r]=this.decimalService.add(this.balances[r-1],this.decimalService.subtract(e[r].debit,e[r].credit))}else this.balances=[]})}submitSearch(){this.transactionService.getCashTransactions(this.startDate(),this.endDate())}startDateChanged(){this.transactionService.startDateChanged(),this.submitSearch()}endDateChanged(){this.submitSearch()}selectToday(){this.transactionService.startDate.set(this.dateService.getCurrentDate()),this.transactionService.endDate.set(this.dateService.getCurrentDate()),this.submitSearch()}selectThisMonth(){this.transactionService.startDate.set(this.dateService.getStartOfMonth()),this.transactionService.endDate.set(this.dateService.getEndOfMonth()),this.submitSearch()}selectThisYear(){this.transactionService.startDate.set(this.dateService.getStartOfYear()),this.transactionService.endDate.set(this.dateService.getEndOfYear()),this.submitSearch()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["cash-transactions"]],standalone:!0,features:[yt],decls:11,vars:2,consts:[[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["dataKey","account_number","styleClass","p-datatable-sm","scrollHeight","68vh",1,"ledger_table",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"mr-2"],["styleClass","p-inputtext-sm","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput","showButtonBar","required","iconDisplay"],["label","Today","severity","secondary",3,"onClick","size"],["styleClass","mx-2","label","This Month","severity","secondary",3,"onClick","size"],["label","This Year","severity","secondary",3,"onClick","size"],["width","20%"],["width","15%"],[3,"ngClass"],["colspan","4"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-toolbar"),v(4,mo,3,6,"ng-template",2)(5,uo,3,6,"ng-template",3)(6,_o,3,3,"ng-template",4),o(),i(7,"p-table",5),v(8,ho,13,0,"ng-template",6)(9,go,16,25,"ng-template",7)(10,fo,7,7,"ng-template",8),o()()()()),r&2&&(a(7),p("value",t.cashTransactions())("scrollable",!0))},dependencies:[je,N,k,it,Ue,Ke,R,O,Ze,H,Ge,F,Qe,$e,B,Ae,Ee,Le,we,tt,Vt]})}}return n})();var Xt=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["app-cash-history"]],decls:1,vars:0,template:function(r,t){r&1&&y(0,"cash-transactions")},dependencies:[ct]})}}return n})();var yo=()=>[10,25,50],Co=()=>({width:"95vw"});function So(n,m){n&1&&(i(0,"tr")(1,"th"),l(2,"Invoice #"),o(),i(3,"th"),l(4,"Customer"),o(),i(5,"th"),l(6,"Created at"),o(),i(7,"th"),l(8,"Deleted at"),o(),i(9,"th"),l(10,"Notes"),o(),i(11,"th"),l(12,"Total"),o(),i(13,"th"),l(14,"Options"),o()())}function bo(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),o(),i(9,"td"),l(10),o(),i(11,"td"),l(12),C(13,"currency"),o(),i(14,"td")(15,"p-button",21),d("onClick",function(){let t=u(e).$implicit,s=c();return _(s.showInvoiceDialog(t))}),o()()()}if(n&2){let e=m.$implicit;a(2),g(e.invoice_number),a(2),g(e.customer_name||"---"),a(2),g(e.order_date),a(2),g(e.deleted_at),a(2),g(e.delete_reason||"---"),a(2),g(b(13,6,e.total_amount))}}function xo(n,m){n&1&&(i(0,"tr")(1,"td",22),l(2,"No Records Found!"),o()())}function wo(n,m){n&1&&(i(0,"th",30),l(1," Unit Cost "),o())}function Eo(n,m){n&1&&(i(0,"th"),l(1,"Total Cost"),o())}function Io(n,m){if(n&1&&(i(0,"tr")(1,"th",25),l(2,"Barcode"),o(),i(3,"th",26),l(4,"Description"),o(),i(5,"th"),l(6,"Expiry Date"),o(),i(7,"th"),l(8,"Original Price"),o(),i(9,"th"),l(10,"Sold Price"),o(),i(11,"th"),l(12,"Discount %"),o(),i(13,"th",27),l(14,"Qty"),o(),i(15,"th"),l(16,"Total Price"),o(),v(17,wo,2,0,"th",28)(18,Eo,2,0,"th",29),o()),n&2){let e=c(3);a(17),p("ngIf",e.userPermissions().show_cost),a(),p("ngIf",e.userPermissions().show_cost)}}function To(n,m){if(n&1&&(i(0,"td",30),l(1),C(2,"currency"),o()),n&2){let e=c().$implicit;a(),S(" ",b(2,1,e.unit_cost)," ")}}function Do(n,m){if(n&1&&(i(0,"td"),l(1),C(2,"currency"),o()),n&2){let e=c().$implicit;a(),S(" ",b(2,1,e.unit_cost*e.quantity)," ")}}function Po(n,m){if(n&1&&(i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),C(9,"currency"),o(),i(10,"td"),l(11),C(12,"currency"),o(),i(13,"td"),l(14),o(),i(15,"td"),l(16),o(),i(17,"td"),l(18),C(19,"currency"),o(),v(20,To,3,3,"td",28)(21,Do,3,3,"td",29),o()),n&2){let e=m.$implicit,r=c(3);a(2),g(e.barcode||"---"),a(2),g(e.product_name),a(2),g(e.expiry_date||"---"),a(2),g(b(9,10,e.original_price)),a(3),S(" ",b(12,12,e.unit_price)," "),a(3),S("",e.discount_percentage,"%"),a(2),g(e.quantity),a(2),S(" ",b(19,14,e.total_price)," "),a(2),p("ngIf",r.userPermissions().show_cost),a(),p("ngIf",r.userPermissions().show_cost)}}function Vo(n,m){n&1&&y(0,"td",30)}function Ho(n,m){if(n&1&&(i(0,"td"),l(1),C(2,"currency"),o()),n&2){let e=c(4);a(),S(" ",b(2,1,e.selectedInvoiceTotals.totalCost)," ")}}function Mo(n,m){if(n&1&&(i(0,"tr"),y(1,"td")(2,"td")(3,"td")(4,"td")(5,"td")(6,"td"),i(7,"td"),l(8),o(),i(9,"td"),l(10),C(11,"currency"),o(),v(12,Vo,1,0,"td",28)(13,Ho,3,3,"td",29),o()),n&2){let e=c(3);a(8),g(e.selectedInvoiceTotals.totalQty),a(2),S(" ",b(11,4,e.selectedInvoiceTotals.totalPrice)," "),a(2),p("ngIf",e.userPermissions().show_cost),a(),p("ngIf",e.userPermissions().show_cost)}}function Fo(n,m){if(n&1&&(i(0,"p-table",24),v(1,Io,19,2,"ng-template",15)(2,Po,22,16,"ng-template",16)(3,Mo,14,6,"ng-template",20),o()),n&2){let e=c(2);p("value",e.invoiceItems)}}function ko(n,m){if(n&1&&v(0,Fo,4,1,"p-table",23),n&2){let e=c();p("ngIf",e.invoiceItems.length!=0)}}function Bo(n,m){if(n&1){let e=x();i(0,"button",31),d("click",function(){u(e);let t=c();return _(t.hideInvoiceDialog())}),o()}}var Zt=(()=>{class n{constructor(){this.customerService=h(K),this.historyService=h(X),this.decimalService=h(ce),this.printService=h(Ve),this.authService=h(se),this.whatsappService=h(st),this.dateService=h(pe),this.userPermissions=this.authService.userPermissions,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.deletedHistory=this.historyService.deletedHistory,this.loading=this.historyService.signal_loading,this.searchForm=new te({invoice_number:new D(null),customer_id:new D(null),start_date:new D(null),end_date:new D(null)}),this.submitSearch()}submitSearch(){this.historyService.fetchDeletedHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchDeletedHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost*r.quantity)}),this.detailsDialogVisible=!0}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["app-delete-history"]],decls:25,vars:33,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus","virtualScroll","virtualScrollItemSize"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","start_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Start Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["formControlName","end_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","End Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],[1,"col-12","md:col-6","lg:col-1"],["type","submit","label","search","icon","pi pi-search","size","small","severity","success","styleClass","w-full",3,"loading"],["icon","pi pi-times","label","Clear","size","small","styleClass","w-full","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["size","small","severity","info","icon","fas fa-eye",3,"onClick"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","15%"],["width","30%"],["width","5%"],["style","border-left: 1px #e5e7eb solid",4,"ngIf"],[4,"ngIf"],[2,"border-left","1px #e5e7eb solid"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5),y(7,"input",6),o(),i(8,"div",5),y(9,"p-dropdown",7),o(),i(10,"div",8),y(11,"p-calendar",9),o(),i(12,"div",8),y(13,"p-calendar",10),o(),i(14,"div",11),y(15,"p-button",12),o(),i(16,"div",11)(17,"p-button",13),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(18,"p-table",14),v(19,So,15,0,"ng-template",15)(20,bo,16,8,"ng-template",16)(21,xo,3,0,"ng-template",17),o()()()(),i(22,"p-dialog",18),I("visibleChange",function(f){return E(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),d("onHide",function(){return t.hideInvoiceDialog()}),v(23,ko,1,1,"ng-template",19)(24,Bo,1,0,"ng-template",20),o()),r&2&&(a(3),p("toggleable",!0),a(),p("formGroup",t.searchForm),a(5),p("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("virtualScroll",!0)("virtualScrollItemSize",38),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),a(2),p("loading",t.loading()),a(2),p("disabled",t.loading()),a(),p("value",t.deletedHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",T(31,yo))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),L(T(32,Co)),w("visible",t.detailsDialogVisible),p("modal",!0)("closable",!0)("maximizable",!0))},dependencies:[ee,U,A,B,G,Q,Y,H,k,ie,O,N,ne,$,z,R,J,F]})}}return n})();var No=()=>[10,25,50];function Oo(n,m){n&1&&(i(0,"tr")(1,"th",18),l(2,"Code"),o(),i(3,"th",19),l(4,"Product Name"),o(),i(5,"th",20),l(6,"Invoice #"),o(),i(7,"th",20),l(8,"Customer"),o(),i(9,"th",20),l(10,"Pet"),o(),i(11,"th",21),l(12,"Datetime"),o(),i(13,"th",20),l(14,"Unit Price"),o(),i(15,"th",22),l(16,"Qty"),o(),i(17,"th",20),l(18,"Total"),o()())}function Ro(n,m){if(n&1&&(i(0,"tr")(1,"td"),l(2),o(),i(3,"td"),l(4),o(),i(5,"td"),l(6),o(),i(7,"td"),l(8),o(),i(9,"td"),l(10),o(),i(11,"td"),l(12),o(),i(13,"td"),l(14),C(15,"currency"),o(),i(16,"td"),l(17),o(),i(18,"td"),l(19),C(20,"currency"),o()()),n&2){let e=m.$implicit;a(2),g(e.sku||"---"),a(2),g(e.product_name),a(2),g(e.invoice_number),a(2),g(e.customer_name),a(2),g(e.pet_name||"---"),a(2),g(e.order_datetime),a(2),g(b(15,9,e.unit_price)),a(3),g(e.quantity),a(2),g(b(20,11,e.total_price))}}function zo(n,m){n&1&&(i(0,"tr")(1,"td",23),l(2,"No Records Found!"),o()())}var ei=(()=>{class n{constructor(){this.historyService=h(X),this.fb=h(Ie),this.api=h(q),this.customersService=h(K),this.authService=h(se),this.stockService=h(Te),this.products=this.stockService.products,this.customers=this.customersService.customers,this.productsHistory=P([]),this.searchForm=this.fb.group({customer_id:[null],product_id:[null],invoice_number:[null],start_date:[null],end_date:[null]}),this.loading=!1,this.fetchProductHistory()}fetchProductHistory(){this.loading=!0,this.api.post("history/products/search",this.searchForm.value).pipe(Se(()=>{this.loading=!1})).subscribe(e=>{this.productsHistory.set(e)})}resetSearch(){this.searchForm.reset(),this.fetchProductHistory()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=V({type:n,selectors:[["products-history"]],decls:24,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","product_id","styleClass","p-inputtext-sm w-full","id","product","appendTo","body","optionLabel","product_name","optionValue","product_id","placeholder","Select Product","filterBy","product_name",3,"onChange","options","filter","showClear","autoOptionFocus","virtualScroll","virtualScrollItemSize"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"ngModelChange"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"onChange","options","filter","showClear","autoOptionFocus","virtualScroll","virtualScrollItemSize"],["formControlName","start_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Start Date",3,"onChange","showIcon","showClear","readonlyInput"],["formControlName","end_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","End Date",3,"onChange","showIcon","showClear","readonlyInput"],[1,"col-12","md:col-6","lg:col-1"],["type","submit","label","search","icon","pi pi-search","size","small","severity","success","styleClass","w-full",3,"loading"],["icon","pi pi-times","label","Clear","size","small","severity","danger","styleClass","w-full",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["width","8%"],["width","25%"],["width","10%"],["width","12%"],["width","5%"],["colspan","11"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.fetchProductHistory()}),i(5,"div",4)(6,"div",5)(7,"p-dropdown",6),d("onChange",function(){return t.fetchProductHistory()}),o()(),i(8,"div",5)(9,"input",7),d("ngModelChange",function(){return t.fetchProductHistory()}),o()(),i(10,"div",5)(11,"p-dropdown",8),d("onChange",function(){return t.fetchProductHistory()}),o()(),i(12,"div",5)(13,"p-calendar",9),d("onChange",function(){return t.fetchProductHistory()}),o()(),i(14,"div",5)(15,"p-calendar",10),d("onChange",function(){return t.fetchProductHistory()}),o()(),i(16,"div",11),y(17,"p-button",12),o(),i(18,"div",11)(19,"p-button",13),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(20,"p-table",14),v(21,Oo,19,0,"ng-template",15)(22,Ro,21,13,"ng-template",16)(23,zo,3,0,"ng-template",17),o()()()()),r&2&&(a(3),p("toggleable",!0),a(),p("formGroup",t.searchForm),a(3),p("options",t.products())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("virtualScroll",!0)("virtualScrollItemSize",38),a(4),p("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("virtualScroll",!0)("virtualScrollItemSize",38),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(2),p("loading",t.loading),a(2),p("disabled",t.loading),a(),p("value",t.productsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",T(29,No))("alwaysShowPaginator",!1)("loading",t.loading))},dependencies:[U,A,B,G,Q,Y,H,k,O,N,$,z,R,J,F]})}}return n})();var Wo=[{path:"sales-history",data:{breadcrumb:"sales"},component:qt},{path:"products-history",data:{breadcrumb:"Products"},component:ei},{path:"payment-history",data:{breadcrumb:"Customer Payments"},component:At},{path:"return-history",data:{breadcrumb:"returns"},component:jt},{path:"purchases-history",data:{breadcrumb:"purchases"},component:Yt},{path:"receipts-history",data:{breadcrumb:"Supplier Payments"},component:Kt},{path:"cash-history",data:{breadcrumb:"Cash"},component:Xt,canActivate:[ut]},{path:"deleted-history",data:{breadcrumb:"deleted invoices"},component:Zt,canActivate:[ut]}],ti=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Oe({type:n})}static{this.\u0275inj=Ne({imports:[dt.forChild(Wo),dt]})}}return n})();var Hs=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Oe({type:n})}static{this.\u0275inj=Ne({imports:[Le,ti,$e,xt,De,Ze,Ge,je,wt,Ue,tt,Qe,Ke,it,Nt,Et,Ot,kt,Ht,et,lt,ct]})}}return n})();export{Hs as HistoryModule};
