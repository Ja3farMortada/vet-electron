import{b as f}from"./chunk-5HBZH4F2.js";import{C as h,Fb as c,J as p,N as l,kc as u,l as o,lc as d,oa as i}from"./chunk-ZWYFQ3XA.js";var D=(()=>{class a{constructor(){this.http=l(c),this.notificationService=l(u),this.api=l(d),this.dateService=l(f),this.suppliers$=new o([]),this.supplierDialogVisible$=new o(!1),this.supplierBalance$=new o([]),this.supplierTotalDebts$=new o({id:0,balance:"0"}),this.tableLoading=i(!1),this.suppliersLoading=i(!1),this.signal_balanceLoading=i(!1),this.submitLoading=i(!1),this.host=this.api.host,this.startDate=i(this.dateService.getStartOfMonth()),this.endDate=i(this.dateService.getCurrentDate()),this.receivables=i([]),this.loadingReceivables=i(!1),this.getSuppliers()}getSuppliers(){this.suppliersLoading.set(!0),this.http.get(`${this.host}/suppliers`).subscribe({next:t=>{this.suppliers$.next(t)},error:t=>{this.notificationService.handleError(t.error,"suppliers"),this.suppliersLoading.set(!1)},complete:()=>{this.suppliersLoading.set(!1)}})}createSupplier(t){this.submitLoading.set(!0),this.http.post(`${this.host}/suppliers`,t).subscribe({next:e=>{this.notificationService.showSuccess("Supplier added successfully!","home"),this.suppliers$.next([...this.suppliers$.value,e.supplier]),this.supplierDialogVisible$.next(!1)},error:e=>{this.notificationService.showError(e.error.message,"home"),this.submitLoading.set(!1)},complete:()=>{this.submitLoading.set(!1)}})}updateSupplier(t){this.submitLoading.set(!0),this.http.put(`${this.host}/suppliers/${t.account_id}`,t).subscribe({next:e=>{let r=this.suppliers$.value.findIndex(n=>n.account_id==e.supplier.account_id),s=this.suppliers$.value;s[r]=e.supplier,this.suppliers$.next(s),this.notificationService.showSuccess("Data updated successfully!","home")},error:e=>{this.notificationService.showError(e,"home"),this.submitLoading.set(!1)},complete:()=>{this.submitLoading.set(!1),this.supplierDialogVisible$.next(!1)}})}deleteSupplier(t){this.submitLoading.set(!0),this.http.delete(`${this.host}/suppliers/${t.account_id}`).subscribe({next:e=>{let r=this.suppliers$.value,s=r.findIndex(n=>n.account_id==t.account_id);r.splice(s,1),this.suppliers$.next(r),this.notificationService.showSuccess(e.message,"home")},error:e=>{this.notificationService.handleError(e.error,"home"),this.submitLoading.set(!1)},complete:()=>{this.submitLoading.set(!1)}})}getSupplierTransactions(t,e,r){this.tableLoading.set(!0),this.http.get(`${this.host}/suppliers/transactions/${t}&${e}&${r}`).subscribe({next:s=>{this.supplierBalance$.next(s)},error:s=>{this.notificationService.handleError(s.error,"home"),this.tableLoading.set(!1)},complete:()=>{this.tableLoading.set(!1)}})}getAccountTotalBalance(t){this.signal_balanceLoading.set(!0),this.http.get(`${this.host}/suppliers/${t}/balance`).subscribe({next:e=>{this.supplierTotalDebts$.next(e)},error:e=>{this.notificationService.handleError(e.error,"home"),this.signal_balanceLoading.set(!1)},complete:()=>{this.signal_balanceLoading.set(!1)}})}getSupplierReceivables(){this.loadingReceivables.set(!0),this.api.get(`suppliers/receivables/${this.startDate()}&${this.endDate()}`).pipe(h(()=>{this.loadingReceivables.set(!1)})).subscribe({next:t=>{this.receivables.set(t)}})}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275prov=p({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{D as a};
