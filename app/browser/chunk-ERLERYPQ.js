import{a as me}from"./chunk-3MNELIWF.js";import{b as ae,c as se}from"./chunk-5RWI34IA.js";import{b as pe}from"./chunk-5HBZH4F2.js";import{i as ne,j as oe,m as le,n as re}from"./chunk-IQYDCUJX.js";import{$a as T,Aa as s,Bc as G,Cc as J,Db as R,Fa as b,Fb as z,Ga as _,Ha as r,J as V,M as S,Mc as K,N as C,Na as v,Nc as X,O as j,Oa as w,Oc as Z,Pa as x,Pc as ee,Ra as p,U as F,V as u,Va as h,W as c,Wa as y,Xa as g,Za as B,_ as M,_a as E,_b as A,ed as te,fd as ie,ha as m,hc as H,i as I,kc as Q,l as P,lc as Y,nc as L,oa as k,ra as d,rc as O,ta as l,vc as $,wa as W,wb as N,yb as q,za as a,zc as U}from"./chunk-ZWYFQ3XA.js";var ue=(()=>{class i{constructor(e,n,t){this.http=e,this.api=n,this.notificationService=t,this.signal_loading=k(!1),this.visible$=new P(!1),this.status_action$=new P({})}deletePayment(e){this.signal_loading.set(!0),this.http.delete(`${this.api.host}/payment/${e}`).subscribe({next:n=>{this.notificationService.showSuccess("Payment deleted successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"DELETE"})}})}submitSupplierPayment(e){this.signal_loading.set(!0),this.http.post(`${this.api.host}/payment/supplier`,e).subscribe({next:n=>{this.notificationService.showSuccess("Payment submitted successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"ADD"})}})}submitSupplierEditPayment(e){this.signal_loading.set(!0),this.http.put(`${this.api.host}/payment/supplier`,e).subscribe({next:n=>{this.notificationService.showSuccess("Payment edited successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"UPDATE"})}})}static{this.\u0275fac=function(n){return new(n||i)(S(z),S(Y),S(Q))}}static{this.\u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var _e=["amountInput"],he=["supplierDropdown"],ye=["paymentDateCalendar"],ge=()=>({width:"75vw"}),fe=()=>({"1199px":"85vw","575px":"95vw"}),ce=i=>({"ng-invalid ng-dirty":i});function Ce(i,f){i&1&&(a(0,"small",19),p(1,"Supplier is required."),s())}function Se(i,f){i&1&&(a(0,"small",19),p(1,"Date is required."),s())}function be(i,f){i&1&&(a(0,"small",19),p(1,"Amount is required."),s())}function ve(i,f){if(i&1){let e=b();a(0,"div",6)(1,"div",7)(2,"div",8)(3,"label",9),p(4,"Supplier"),a(5,"span",10),p(6," *"),s()(),a(7,"p-dropdown",11,0),g("ngModelChange",function(t){u(e);let o=r();return y(o.currennt_account,t)||(o.currennt_account=t),c(t)}),s(),d(9,Ce,2,0,"small",12),s()(),a(10,"div",7)(11,"label",13),p(12,"Payment Date"),a(13,"span",10),p(14," *"),s()(),a(15,"p-calendar",14,1),g("ngModelChange",function(t){u(e);let o=r();return y(o.payment_date,t)||(o.payment_date=t),c(t)}),s(),d(17,Se,2,0,"small",12),s(),a(18,"div",7)(19,"div",8)(20,"label",15),p(21,"Amount"),a(22,"span",10),p(23," *"),s()(),a(24,"p-inputNumber",16,2),g("ngModelChange",function(t){u(e);let o=r();return y(o.amount,t)||(o.amount=t),c(t)}),_("onFocus",function(t){u(e);let o=r();return c(o.selectInput(t))}),s(),d(26,be,2,0,"small",12),s()(),a(27,"div",7)(28,"label",17),p(29,"Notes"),s(),a(30,"input",18),g("ngModelChange",function(t){u(e);let o=r();return y(o.journal_notes,t)||(o.journal_notes=t),c(t)}),s()()()}if(i&2){let e=r();m(7),l("options",e.accounts),h("ngModel",e.currennt_account),l("required",!0)("filter",!0)("showClear",!0)("virtualScroll",!0)("virtualScrollItemSize",38),m(2),l("ngIf",e.submitted&&!e.currennt_account),m(6),h("ngModel",e.payment_date),l("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showTime",!0)("ngClass",T(22,ce,!e.payment_date)),m(2),l("ngIf",e.submitted&&!e.payment_date),m(7),h("ngModel",e.amount),l("required",!0)("autofocus",!0)("maxFractionDigits",3)("ngClass",T(24,ce,!e.amount)),m(2),l("ngIf",e.submitted&&!e.amount),m(4),h("ngModel",e.journal_notes)}}function we(i,f){if(i&1){let e=b();a(0,"p-button",23),_("onClick",function(){u(e);let t=r(2);return c(t.deletePayment())}),s()}if(i&2){let e=r(2);l("disabled",e.loading())}}function xe(i,f){if(i&1){let e=b();d(0,we,1,1,"p-button",20),a(1,"p-button",21),_("onClick",function(){u(e);let t=r();return c(t.closeDialog())}),s(),a(2,"p-button",22),_("onClick",function(){u(e);let t=r();return c(t.submitPayment())}),s()}if(i&2){let e=r();l("ngIf",e.dialog_mode==="edit"),m(),l("disabled",e.loading()),m(),l("loading",e.loading())}}var at=(()=>{class i{constructor(){this.visible=!1,this.accounts=[],this.dialog_mode="add",this.type="supplier",this.onClose=new M,this.onSubmit=new M,this.currennt_account=null,this.subscriptions=new I,this.accountsService=C(me),this.paymentService=C(ue),this.confirmationService=C(A),this.dateService=C(pe),this.amount=null,this.submitted=!1,this.loading=this.paymentService.signal_loading,this.payment_date=this.dateService.getCurrentDatetime(),this.journal_notes=""}ngOnInit(){this.subscriptions.add(this.paymentService.visible$.subscribe(e=>{this.visible=e})),this.subscriptions.add(this.paymentService.status_action$.subscribe(e=>{e.action&&(this.onSubmit.emit(e),this.accountsService.getAccountTotalBalance(this.currennt_account),this.paymentService.status_action$.next({}))}))}ngOnChanges(){this.visible&&this.dialog_mode==="edit"&&this.selected_payment?(this.amount=this.selected_payment.total_value,this.payment_date=this.dateService.formatDate(this.selected_payment.payment_date,"YYYY-MM-DD HH:mm"),this.currennt_account=this.selected_payment.partner_id,this.journal_notes=this.selected_payment.journal_notes):this.visible&&this.dialog_mode==="add"&&(this.payment_date=this.dateService.getCurrentDatetime(),this.currennt_account=this.selected_account)}ngOnDestroy(){this.subscriptions.unsubscribe()}closeDialog(){this.visible=!1,this.onClose.emit(),this.submitted=!1,this.amount=null}submitPayment(){this.submitted=!0,this.amount>0&&this.currennt_account&&this.payment_date?(this.payment_date=this.dateService.formatDate(this.payment_date,"YYYY-MM-DD HH:mm"),this.dialog_mode==="add"?this.paymentService.submitSupplierPayment({amount:this.amount,account_id:this.currennt_account,payment_date:this.payment_date,journal_notes:this.journal_notes}):this.paymentService.submitSupplierEditPayment({amount:this.amount,account_id:this.currennt_account,payment_date:this.payment_date,journal_id:this.selected_payment.journal_id,journal_notes:this.journal_notes})):this.amount?this.currennt_account?this.paymentDateCalendar.inputfieldViewChild.nativeElement.focus():this.supplierDropdown.applyFocus():this.amountInput.el.nativeElement.children[0].children[0].focus()}deletePayment(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.paymentService.deletePayment(this.selected_payment.journal_id)}})}selectInput(e){e.target.select()}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=j({type:i,selectors:[["supplier-payment-dialog"]],viewQuery:function(n,t){if(n&1&&(v(_e,5),v(he,5),v(ye,5)),n&2){let o;w(o=x())&&(t.amountInput=o.first),w(o=x())&&(t.supplierDropdown=o.first),w(o=x())&&(t.paymentDateCalendar=o.first)}},inputs:{visible:"visible",accounts:"accounts",selected_account:"selected_account",selected_payment:"selected_payment",dialog_mode:"dialog_mode",type:"type"},outputs:{onClose:"onClose",onSubmit:"onSubmit"},standalone:!0,features:[F,B],decls:3,vars:10,consts:[["supplierDropdown",""],["paymentDateCalendar",""],["amountInput",""],["position","top","header","Payment","styleClass","p-fluid",3,"visibleChange","onHide","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"formgrid","grid"],[1,"field","col-12","md:col-3"],[1,"flex","flex-column","gap-2"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","options","ngModel","required","filter","showClear","virtualScroll","virtualScrollItemSize"],["class","p-error",4,"ngIf"],["for","payment_date"],["styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"ngModelChange","ngModel","showIcon","showClear","readonlyInput","showTime","ngClass"],["for","amount"],["styleClass","input-align-center","mode","currency","currency","USD","locale","en-US",1,"p-inputtext-sm",3,"ngModelChange","onFocus","ngModel","required","autofocus","maxFractionDigits","ngClass"],["for","notes"],["type","text","pInputText","","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","ngModel"],[1,"p-error"],["pRipple","","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"disabled","onClick",4,"ngIf"],["pRipple","","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","disabled"],["pRipple","","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","loading"],["pRipple","","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"onClick","disabled"]],template:function(n,t){n&1&&(a(0,"p-dialog",3),g("visibleChange",function(D){return y(t.visible,D)||(t.visible=D),D}),_("onHide",function(){return t.closeDialog()}),d(1,ve,31,26,"ng-template",4)(2,xe,3,3,"ng-template",5),s()),n&2&&(W(E(8,ge)),l("modal",!0),h("visible",t.visible),l("breakpoints",E(9,fe))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[ie,te,H,X,K,ee,Z,se,ae,oe,ne,R,N,q,G,L,O,U,$,J,re,le]})}}return i})();export{at as a};
