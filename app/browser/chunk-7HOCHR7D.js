import{a as z}from"./chunk-SHTNEOCI.js";import{b as ce,c as _e}from"./chunk-65IROLXL.js";import"./chunk-MEMFBDSU.js";import{a as be,b as Se}from"./chunk-JBIETLWA.js";import{b as ve}from"./chunk-S7PF4F6G.js";import{f as O,g as ye,h as Ee,q as we}from"./chunk-5RWI34IA.js";import"./chunk-LSU6PTXH.js";import"./chunk-5HBZH4F2.js";import{b as ie}from"./chunk-LQIUUWFA.js";import{a as re,b as ae}from"./chunk-VZUVB6OR.js";import{i as fe,j as he,m as xe,n as Ce}from"./chunk-IQYDCUJX.js";import{Aa as t,Ba as k,Bc as le,C as H,Cb as Z,Db as $,Fa as E,Fb as ee,Ga as u,Ha as h,J as Q,K as P,Mc as se,N as x,Na as K,Nc as pe,O as U,Oa as q,Oc as me,P as I,Pa as J,Pc as de,Qa as B,Ra as l,Sa as f,Ta as R,Ub as L,V as m,Va as w,W as d,Wa as b,Xa as S,_a as v,a as A,b as G,ed as ue,fd as ge,ha as a,hb as T,hc as te,ib as M,kc as j,lc as F,oa as y,ra as C,rc as ne,ta as _,tb as X,vc as oe,wa as W,yb as Y,za as e}from"./chunk-ZWYFQ3XA.js";var Ve=(()=>{class n{constructor(){this.http=x(ee),this.api=x(F),this.notificationService=x(j),this.host=this.api.host,this.expenses=y([]),this.loading_table=y(!1),this.user_balance=y({}),this.laoding_balance=y(!1),this.searchParams=y({expense_category:null,start_date:null,end_date:null}),this.getExpenses()}getExpenses(){this.loading_table.set(!0);let o=this.searchParams(),s={};Object.entries(o).forEach(([i,r])=>{r!=null&&r!==""&&(s[i]=r)}),this.api.get("expense",{params:s}).pipe(H(()=>this.loading_table.set(!1))).subscribe({next:i=>{this.expenses.set(i)}})}static{this.\u0275fac=function(s){return new(s||n)}}static{this.\u0275prov=Q({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Te=()=>[10,25,50],Pe=()=>["journal_number","journal_description","journal_notes","payment_date"],He=()=>({width:"95vw"});function Ie(n,g){n&1&&(e(0,"tr")(1,"th",34),l(2,"Expense #"),t(),e(3,"th",35),l(4,"Category"),t(),e(5,"th",36),l(6,"Description"),t(),e(7,"th",37),l(8," Datetime "),k(9,"p-sortIcon",38),t(),e(10,"th",35),l(11,"Total"),t(),e(12,"th",39),l(13,"Options"),t()())}function ke(n,g){if(n&1){let o=E();e(0,"p-button",42),u("onClick",function(){m(o);let i=h().$implicit,r=h();return d(r.openEditDialog(i))}),t()}}function je(n,g){if(n&1){let o=E();e(0,"p-button",43),u("onClick",function(){m(o);let i=h().$implicit,r=h();return d(r.openEditHistoryDialog(i))}),t()}if(n&2){let o=h(2);_("loading",o.loadingEditHistory)}}function Fe(n,g){if(n&1&&(e(0,"tr")(1,"td"),l(2),t(),e(3,"td"),l(4),t(),e(5,"td"),l(6),t(),e(7,"td"),l(8),t(),e(9,"td"),l(10),T(11,"currency"),t(),e(12,"td"),C(13,ke,1,0,"p-button",40),t(),e(14,"td"),C(15,je,1,1,"p-button",41),t()()),n&2){let o=g.$implicit;a(2),f(o.journal_number),a(2),f(o.journal_notes||"---"),a(2),f(o.journal_description),a(2),f(o.payment_date),a(2),f(M(11,7,o.total_value)),a(3),_("ngIf",o.journal_number.substr(0,3)!="REC"),a(2),_("ngIf",o.updated_at)}}function Oe(n,g){n&1&&(e(0,"tr")(1,"td",44),l(2,"No Records Found!"),t()())}function ze(n,g){n&1&&(e(0,"tr")(1,"th"),l(2,"Created At"),t(),e(3,"th"),l(4,"Updated At"),t(),e(5,"th"),l(6,"Update Reason"),t(),e(7,"th"),l(8,"Old Value"),t()())}function We(n,g){if(n&1&&(e(0,"tr")(1,"td"),l(2),t(),e(3,"td"),l(4),t(),e(5,"td"),l(6),t(),e(7,"td"),l(8),T(9,"currency"),t()()),n&2){let o=g.$implicit;a(2),f(o.journal_date),a(2),f(o.updated_at),a(2),f(o.update_reason),a(2),R(" ",M(9,4,o.total_value)," ")}}function Be(n,g){if(n&1&&(e(0,"p-table",45),C(1,ze,9,0,"ng-template",26)(2,We,10,6,"ng-template",27),t()),n&2){let o=h();_("value",o.editHistory)}}function Re(n,g){if(n&1){let o=E();e(0,"p-button",46),u("onClick",function(){m(o);let i=h();return d(i.editHistoryDialogVisible=!1)}),t()}}function Le(n,g){n&1&&(e(0,"tr")(1,"th"),l(2,"Expense #"),t(),e(3,"th"),l(4,"Description"),t(),e(5,"th"),l(6,"Created At"),t(),e(7,"th"),l(8,"Deleted At"),t(),e(9,"th"),l(10,"Delete Reason"),t(),e(11,"th"),l(12,"total"),t()())}function Ne(n,g){if(n&1&&(e(0,"tr")(1,"td"),l(2),t(),e(3,"td"),l(4),t(),e(5,"td"),l(6),t(),e(7,"td"),l(8),t(),e(9,"td"),l(10),t(),e(11,"td"),l(12),T(13,"currency"),t()()),n&2){let o=g.$implicit;a(2),f(o.journal_number),a(2),f(o.journal_description),a(2),f(o.payment_date),a(2),f(o.deleted_at),a(2),f(o.delete_reason),a(2),f(M(13,6,o.total_value))}}function Ae(n,g){if(n&1&&(e(0,"p-table",47),C(1,Le,13,0,"ng-template",26)(2,Ne,14,8,"ng-template",27),t()),n&2){let o=h();_("value",o.deletedHistory)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",v(6,Te))("alwaysShowPaginator",!0)}}function Ge(n,g){if(n&1){let o=E();e(0,"p-button",46),u("onClick",function(){m(o);let i=h();return d(i.deletedDialogVisible=!1)}),t()}}var Me=(()=>{class n{constructor(){this.userService=x(ie),this.expensesService=x(Ve),this.api=x(F),this.notification=x(j),this.expenses=this.expensesService.expenses,this.expenses_dialog_visible=!1,this.loading=this.expensesService.loading_table,this.loading_balance=this.expensesService.laoding_balance,this.dialog_mode="add",this.balance=this.expensesService.user_balance,this.userType=this.userService.userType,this.totalExpenses=X(()=>this.expenses().reduce((o,s)=>o+parseFloat(s.total_value),0)),this.categories=["Medical Supplies","Pet Food","Utilities","Miscellaneous","Salaries","Outsourced","Maintenance","Other"],this.cols=[{field:"journal_number",header:"Expense #"},{field:"journal_notes",header:"Category"},{field:"journal_description",header:"Description"},{field:"total_value",header:"Total"},{field:"payment_date",header:"Datetime"}],this.searchParams=this.expensesService.searchParams,this.editHistoryDialogVisible=!1,this.loadingEditHistory=!1,this.deletedDialogVisible=!1,this.loadingGetDeleted=!1,this.deletedHistory=[]}reset(){this.searchParams.set({expense_category:null,start_date:null,end_date:null}),this.refetchExpenses()}addExpense(){this.dialog_mode="add",this.expenses_dialog_visible=!0}openEditDialog(o){this.dialog_mode="edit",this.selected_payment=o,this.expenses_dialog_visible=!0}onExpenseSumbitted(o){this.refetchExpenses()}closeDialog(){this.expenses_dialog_visible=!1}refetchExpenses(){this.expensesService.getExpenses(),this.ct.reset()}refreshBalance(){}openEditHistoryDialog(o){this.loadingEditHistory=!0,this.api.get(`expense/edits/${o.journal_id}`).pipe(H(()=>{this.loadingEditHistory=!1})).subscribe({next:s=>{this.editHistoryDialogVisible=!0,this.editHistory=s}})}getDeletedExpenses(){this.loadingGetDeleted=!0,this.api.get("expense/deleted").pipe(H(()=>{this.loadingGetDeleted=!1})).subscribe({next:o=>{this.deletedDialogVisible=!0,this.deletedHistory=o}})}exportExcel(){let o=[...this.ct.value],s=[];this.ct.filteredValue&&(s=[...this.ct.filteredValue]);let i=[];this.ct.filteredValue?i=[...this.ct.filteredValue]:i=[...this.ct.value];let r=i.map(c=>{let V=(c.payment_date?c.payment_date.toString():"").substring(0,10),D=V.split("-");return D.length===3&&(V=`${D[1]}/${D[2]}/${D[0]}`),G(A({},c),{payment_date:V})});this.ct.value=r,this.ct.filteredValue&&(this.ct.filteredValue=r),this.ct?.exportCSV(),this.ct.filteredValue&&(this.ct.filteredValue=s),this.ct.value=o}static{this.\u0275fac=function(s){return new(s||n)}}static{this.\u0275cmp=U({type:n,selectors:[["app-expenses-home"]],viewQuery:function(s,i){if(s&1&&K(O,5),s&2){let r;q(r=J())&&(i.ct=r.first)}},decls:49,vars:47,consts:[["tableSearch",""],["ct",""],[1,"grid","m-1"],[1,"col-12"],[1,"grid"],[1,"col-12","md:col-6","lg:col-2"],["for",""],["placeholder","Select Expense Category",1,"w-full","p-inputtext-sm",3,"ngModelChange","options","showClear","ngModel","filter","autoOptionFocus"],["styleClass","w-full p-inputtext-sm","dateFormat","yy-mm-dd","placeholder","Select Start Date",3,"ngModelChange","ngModel","showIcon","showClear"],["styleClass","w-full p-inputtext-sm","dateFormat","yy-mm-dd","placeholder","Select End Date",3,"ngModelChange","ngModel","showIcon","showClear"],[1,"col-6","md:col-6","lg:col-2","align-self-end"],["label","search","icon","pi pi-search","severity","primary","styleClass","w-full","size","small",3,"onClick","loading"],[1,"col-6","md:col-6","lg:col-1","align-self-end"],["label","reset","icon","pi pi-times","severity","danger","styleClass","w-full","size","small",3,"onClick"],["label","new","icon","pi pi-plus","severity","success","styleClass","w-full","size","small",3,"onClick"],["label","deleted","icon","pi pi-history","severity","contrast","styleClass","w-full","size","small",3,"onClick"],[1,"col-12","md:col-6","lg:col-1","align-self-end"],["label","export","icon","pi pi-file-excel","severity","success","styleClass","w-full","size","small",3,"onClick","outlined"],["styleClass","m-1"],[1,"col-12","md:col-6","lg:col-2","align-self-end"],[1,"p-input-icon-left","w-full"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search in results ...",1,"p-inputtext-sm","w-full",3,"input","value"],[1,"col-12","md:col-6","lg:col-10","flex","justify-content-center","lg:justify-content-end","align-items-center"],[1,"m-0","text-red-500"],["dataKey","journal_id","styleClass","p-datatable-sm mt-2",3,"exportHeader","columns","value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading","globalFilterFields","filterDelay"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"OnClose","OnSubmit","visible","selected_payment","dialog_mode"],["header","Edit History","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["header","Deleted Expenses","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["width","10%"],["width","15%"],["width","30%"],["width","20%","pSortableColumn","payment_date"],["field","payment_date"],["colspan","2","width","10%"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick",4,"ngIf"],["size","small","severity","help","icon","pi pi-history",3,"loading","onClick",4,"ngIf"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["size","small","severity","help","icon","pi pi-history",3,"onClick","loading"],["colspan","11"],["dataKey","record_id","styleClass","p-datatable-sm",3,"value"],["label","Close","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["dataKey","record_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator"]],template:function(s,i){if(s&1){let r=E();e(0,"div",2)(1,"div",3)(2,"p-card")(3,"div",4)(4,"div",5)(5,"label",6),l(6,"Expense Category"),t(),e(7,"p-dropdown",7),S("ngModelChange",function(p){return m(r),b(i.searchParams().expense_category,p)||(i.searchParams().expense_category=p),d(p)}),u("ngModelChange",function(){return m(r),d(i.refetchExpenses())}),t()(),e(8,"div",5)(9,"label",6),l(10,"Start Date"),t(),e(11,"p-calendar",8),S("ngModelChange",function(p){return m(r),b(i.searchParams().start_date,p)||(i.searchParams().start_date=p),d(p)}),u("ngModelChange",function(){return m(r),d(i.refetchExpenses())}),t()(),e(12,"div",5)(13,"label",6),l(14,"End Date"),t(),e(15,"p-calendar",9),S("ngModelChange",function(p){return m(r),b(i.searchParams().end_date,p)||(i.searchParams().end_date=p),d(p)}),u("ngModelChange",function(){return m(r),d(i.refetchExpenses())}),t()(),e(16,"div",10)(17,"p-button",11),u("onClick",function(){return m(r),d(i.refetchExpenses())}),t()(),e(18,"div",12)(19,"p-button",13),u("onClick",function(){return m(r),d(i.reset())}),t()(),e(20,"div",12)(21,"p-button",14),u("onClick",function(){return m(r),d(i.addExpense())}),t()(),e(22,"div",12)(23,"p-button",15),u("onClick",function(){return m(r),d(i.getDeletedExpenses())}),t()(),e(24,"div",16)(25,"p-button",17),u("onClick",function(){return m(r),d(i.exportExcel())}),t()(),e(26,"div",3),k(27,"p-divider",18),t(),e(28,"div",19)(29,"span",20),k(30,"i",21),e(31,"input",22,0),u("input",function(p){m(r);let V=B(38);return d(V.filterGlobal(p.target.value,"contains"))}),t()()(),e(33,"div",23)(34,"h2",24),l(35),T(36,"currency"),t()()(),e(37,"p-table",25,1),C(39,Ie,14,0,"ng-template",26)(40,Fe,16,9,"ng-template",27)(41,Oe,3,0,"ng-template",28),t()()()(),e(42,"expenses-dialog",29),u("OnClose",function(){return m(r),d(i.closeDialog())})("OnSubmit",function(p){return m(r),d(i.onExpenseSumbitted(p))}),t(),e(43,"p-dialog",30),S("visibleChange",function(p){return m(r),b(i.editHistoryDialogVisible,p)||(i.editHistoryDialogVisible=p),d(p)}),u("onHide",function(){return m(r),d(i.editHistory=null)}),C(44,Be,3,1,"ng-template",31)(45,Re,1,0,"ng-template",32),t(),e(46,"p-dialog",33),S("visibleChange",function(p){return m(r),b(i.deletedDialogVisible,p)||(i.deletedDialogVisible=p),d(p)}),u("onHide",function(){return m(r),d(i.deletedHistory=[])}),C(47,Ae,3,7,"ng-template",31)(48,Ge,1,0,"ng-template",32),t()}if(s&2){let r=B(38);a(7),_("options",i.categories)("showClear",!0),w("ngModel",i.searchParams().expense_category),_("filter",!0)("autoOptionFocus",!1),a(4),w("ngModel",i.searchParams().start_date),_("showIcon",!1)("showClear",!0),a(4),w("ngModel",i.searchParams().end_date),_("showIcon",!1)("showClear",!0),a(2),_("loading",i.loading()),a(8),_("outlined",!0),a(6),_("value",r.filters.global==null?null:r.filters.global.value),a(4),R(" Total: ",M(36,41,i.totalExpenses())," "),a(2),_("exportHeader","Expenses")("columns",i.cols)("value",i.expenses())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",v(43,Te))("alwaysShowPaginator",!0)("loading",i.loading())("globalFilterFields",v(44,Pe))("filterDelay",0),a(5),_("visible",i.expenses_dialog_visible)("selected_payment",i.selected_payment)("dialog_mode",i.dialog_mode),a(),W(v(45,He)),w("visible",i.editHistoryDialogVisible),_("modal",!0)("closable",!0)("maximizable",!0),a(3),W(v(46,He)),w("visible",i.deletedDialogVisible),_("modal",!0)("closable",!0)("maximizable",!0)}},dependencies:[Y,ne,oe,se,te,z,re,O,ye,Ee,xe,fe,me,ue,be,Z]})}}return n})();var Qe=[{path:"",component:Me}],De=(()=>{class n{static{this.\u0275fac=function(s){return new(s||n)}}static{this.\u0275mod=I({type:n})}static{this.\u0275inj=P({imports:[L.forChild(Qe),L]})}}return n})();var Nt=(()=>{class n{static{this.\u0275fac=function(s){return new(s||n)}}static{this.\u0275mod=I({type:n})}static{this.\u0275inj=P({imports:[$,le,De,pe,z,ae,we,Ce,he,ve,de,ce,_e,ge,Se]})}}return n})();export{Nt as ExpensesModule};
